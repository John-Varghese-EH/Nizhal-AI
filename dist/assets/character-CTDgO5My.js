const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./OptimizedVRMAvatar-BNVceco_.js","./globals-D1OvrEqP.js","./react-vendor-BoJ_KTUm.js","./animation-MOF9A5il.js","./globals-DWDtLreh.css","./three-dWqUxecu.js"])))=>i.map(i=>d[i]);
import{_ as Ut,a as Vt,b as Yt}from"./globals-D1OvrEqP.js";import{j as a,A as me,m as U}from"./animation-MOF9A5il.js";import{a as p,R as pt}from"./react-vendor-BoJ_KTUm.js";import{e as mt,T as gt,a as Ne,c as Kt,C as Xt}from"./three-dWqUxecu.js";class qt{constructor(){this.audioContext=null,this.analyser=null,this.dataArray=null,this.isListening=!1,this.isDancing=!1,this.callbacks=new Set,this.lastBeatTime=0,this.beatThreshold=.6,this.beatCooldown=200,this.energyHistory=[],this.historyLength=43,this.currentDanceMove=0,this.danceIntensity=0,this.bpm=0}async initialize(){if(this.audioContext)return!0;try{return this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=512,this.analyser.smoothingTimeConstant=.8,this.dataArray=new Uint8Array(this.analyser.frequencyBinCount),!0}catch(e){return console.error("Failed to initialize audio context:",e),!1}}async startMicrophoneListening(){if(!await this.initialize())return!1;try{const e=await navigator.mediaDevices.getUserMedia({audio:!0});return this.audioContext.createMediaStreamSource(e).connect(this.analyser),this.isListening=!0,this.analyze(),!0}catch(e){return console.error("Microphone access denied:",e),!1}}async startSystemAudioListening(){if(!await this.initialize())return!1;try{const e=await navigator.mediaDevices.getUserMedia({audio:{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop"}}});return this.audioContext.createMediaStreamSource(e).connect(this.analyser),this.isListening=!0,this.analyze(),!0}catch{return console.log("System audio not available, falling back to microphone"),this.startMicrophoneListening()}}analyze(){if(!this.isListening||!this.analyser)return;this.analyser.getByteFrequencyData(this.dataArray);let e=0;const n=Math.floor(this.dataArray.length*.15);for(let v=0;v<n;v++)e+=this.dataArray[v];e=e/(n*255);let i=0;for(let v=0;v<this.dataArray.length;v++)i+=this.dataArray[v];i=i/(this.dataArray.length*255),this.energyHistory.push(e),this.energyHistory.length>this.historyLength&&this.energyHistory.shift();const r=this.energyHistory.reduce((v,I)=>v+I,0)/this.energyHistory.length,s=Date.now(),o=e>r*1.4&&e>this.beatThreshold&&s-this.lastBeatTime>this.beatCooldown;o&&(this.lastBeatTime=s,this.currentDanceMove=(this.currentDanceMove+1)%8,this.energyHistory.length>0&&this.estimateBPM());const c=i>.1?Math.min(1,i*3):0;this.danceIntensity=this.danceIntensity*.9+c*.1,this.isDancing=this.danceIntensity>.15;const y={isDancing:this.isDancing,intensity:this.danceIntensity,move:this.currentDanceMove,beat:o,bpm:this.bpm,bassEnergy:e,totalEnergy:i};this.callbacks.forEach(v=>v(y)),requestAnimationFrame(()=>this.analyze())}estimateBPM(){const e=Date.now()-this.lastBeatTime;if(e>0&&e<2e3){const n=6e4/e;this.bpm===0?this.bpm=n:this.bpm=this.bpm*.8+n*.2,this.bpm=Math.max(60,Math.min(180,this.bpm))}}getDanceParams(){return{...[{name:"sway",armAngle:0,bodyTilt:.1},{name:"bounce",armAngle:30,bodyTilt:0},{name:"leftWave",armAngle:-45,bodyTilt:-.1},{name:"rightWave",armAngle:45,bodyTilt:.1},{name:"nod",armAngle:0,bodyTilt:0},{name:"spin",armAngle:0,bodyTilt:0},{name:"jump",armAngle:60,bodyTilt:0},{name:"groove",armAngle:20,bodyTilt:.05}][this.currentDanceMove],intensity:this.danceIntensity,bpm:this.bpm}}onDanceUpdate(e){return this.callbacks.add(e),()=>this.callbacks.delete(e)}stop(){this.isListening=!1,this.isDancing=!1,this.danceIntensity=0}dispose(){this.stop(),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.callbacks.clear()}}class Jt{constructor(){this.currentExpression="neutral",this.expressionIntensity=0,this.callbacks=new Set,this.lastPosition={x:0,y:0},this.velocity={x:0,y:0},this.acceleration={x:0,y:0},this.expressionTimer=null,this.blinkTimer=null,this.nextBlinkTime=3e3+Math.random()*4e3,this.isMoving=!1,this.isFalling=!1,this.isSpinning=!1,this.isDragging=!1,this.expressionQueue=[],this.expressionMap={neutral:{eyes:"normal",mouth:"neutral",brows:"normal"},happy:{eyes:"happy",mouth:"smile",brows:"raised"},surprised:{eyes:"wide",mouth:"o",brows:"raised"},dizzy:{eyes:"spiral",mouth:"wavy",brows:"normal"},scared:{eyes:"wide",mouth:"small",brows:"worried"},sleepy:{eyes:"closed",mouth:"neutral",brows:"relaxed"},excited:{eyes:"sparkle",mouth:"grin",brows:"raised"},thinking:{eyes:"look_up",mouth:"hmm",brows:"raised"},sad:{eyes:"down",mouth:"frown",brows:"worried"},concerned:{eyes:"soft",mouth:"slight_frown",brows:"worried"},playful:{eyes:"wink",mouth:"smirk",brows:"raised"}}}initialize(){this.startBlinkLoop()}updatePosition(e){const n=e.x-this.lastPosition.x,i=e.y-this.lastPosition.y,r={...this.velocity};this.velocity={x:n,y:i},this.acceleration={x:this.velocity.x-r.x,y:this.velocity.y-r.y};const s=Math.sqrt(n*n+i*i);this.isMoving=s>5,this.isFalling=i>10,this.isSpinning=Math.abs(n)>20,this.isFalling&&i>30?this.setExpression("scared",1):this.isSpinning?this.setExpression("dizzy",.8):this.isMoving&&s>15?this.setExpression("excited",.6):!this.isMoving&&!this.expressionQueue.length&&this.fadeToNeutral(),this.lastPosition={...e}}setExpression(e,n=1,i=2e3){this.expressionMap[e]&&(this.currentExpression=e,this.expressionIntensity=n,this.notifyListeners(),this.expressionTimer&&clearTimeout(this.expressionTimer),i>0&&(this.expressionTimer=setTimeout(()=>{this.fadeToNeutral()},i)))}fadeToNeutral(){if(this.currentExpression==="neutral")return;const e=()=>{this.expressionIntensity-=.1,this.expressionIntensity<=0&&(this.currentExpression="neutral",this.expressionIntensity=0),this.notifyListeners(),this.expressionIntensity>0&&requestAnimationFrame(e)};e()}startBlinkLoop(){const e=()=>{this.currentExpression,this.triggerBlink(),this.nextBlinkTime=2e3+Math.random()*5e3,this.blinkTimer=setTimeout(e,this.nextBlinkTime)};this.blinkTimer=setTimeout(e,this.nextBlinkTime)}triggerBlink(){this.callbacks.forEach(e=>e({type:"blink",expression:this.currentExpression,intensity:this.expressionIntensity}))}onEvent(e){switch(e){case"pickup":this.setExpression("surprised",1,500);break;case"drop":this.setExpression("scared",.8,1500);break;case"pat":this.setExpression("happy",1,3e3);break;case"poke":this.setExpression("surprised",.6,1e3);break;case"dance":this.setExpression("excited",1,0);break;case"sit":this.setExpression("neutral",.5,0);break;case"thinking":this.setExpression("thinking",.8,0);break;case"speaking":this.setExpression("happy",.5,0);break;case"happy":this.setExpression("happy",.9,5e3);break;case"sad":this.setExpression("sad",.7,5e3);break;case"excited":this.setExpression("excited",1,5e3);break;case"concerned":this.setExpression("concerned",.6,5e3);break;case"playful":this.setExpression("playful",.8,5e3);break;case"neutral":this.fadeToNeutral();break;default:this.expressionMap[e]&&this.setExpression(e,.8,5e3)}}getExpression(){return{name:this.currentExpression,intensity:this.expressionIntensity,details:this.expressionMap[this.currentExpression],isMoving:this.isMoving,isFalling:this.isFalling}}onExpressionChange(e){return this.callbacks.add(e),()=>this.callbacks.delete(e)}notifyListeners(){this.callbacks.forEach(e=>e({type:"expression",expression:this.currentExpression,intensity:this.expressionIntensity,details:this.expressionMap[this.currentExpression]}))}setDragging(e){this.isDragging=e,e?this.onEvent("pickup"):this.onEvent("drop")}dispose(){this.expressionTimer&&clearTimeout(this.expressionTimer),this.blinkTimer&&clearTimeout(this.blinkTimer),this.callbacks.clear()}}const d={IDLE:"idle",DRAGGING:"dragging",SITTING:"sitting",SITTING_WINDOW:"sitting_window",SITTING_TASKBAR:"sitting_taskbar",DANCING:"dancing",SLEEPING:"sleeping",HAPPY:"happy",SAD:"sad",EXCITED:"excited",EMBARRASSED:"embarrassed",THINKING:"thinking",SPEAKING:"speaking"},Zt={[d.IDLE]:[d.DRAGGING,d.SITTING,d.SITTING_WINDOW,d.SITTING_TASKBAR,d.DANCING,d.SLEEPING,d.HAPPY,d.SAD,d.EXCITED,d.EMBARRASSED,d.THINKING,d.SPEAKING],[d.DRAGGING]:[d.IDLE,d.SITTING,d.SITTING_WINDOW,d.SITTING_TASKBAR],[d.SITTING]:[d.IDLE,d.DRAGGING,d.SLEEPING,d.HAPPY],[d.SITTING_WINDOW]:[d.IDLE,d.DRAGGING,d.SLEEPING],[d.SITTING_TASKBAR]:[d.IDLE,d.DRAGGING,d.SLEEPING],[d.DANCING]:[d.IDLE],[d.SLEEPING]:[d.IDLE,d.DRAGGING],[d.HAPPY]:[d.IDLE,d.DRAGGING],[d.SAD]:[d.IDLE,d.DRAGGING],[d.EXCITED]:[d.IDLE,d.DRAGGING],[d.EMBARRASSED]:[d.IDLE],[d.THINKING]:[d.IDLE,d.SPEAKING],[d.SPEAKING]:[d.IDLE,d.THINKING]},Te={[d.IDLE]:{breathingSpeed:1.5,breathingAmplitude:.01,swaySpeed:.5,swayAmplitude:.003,expression:"neutral",expressionWeight:.3},[d.DRAGGING]:{breathingSpeed:0,breathingAmplitude:0,swaySpeed:0,swayAmplitude:0,expression:"surprised",expressionWeight:.6,floatSpeed:3,floatAmplitude:.02},[d.SITTING]:{breathingSpeed:1.2,breathingAmplitude:.008,swaySpeed:.3,swayAmplitude:.002,expression:"relaxed",expressionWeight:.5,poseRotation:{x:0,y:0,z:0}},[d.SITTING_TASKBAR]:{breathingSpeed:1.2,breathingAmplitude:.008,swaySpeed:.3,swayAmplitude:.002,expression:"relaxed",expressionWeight:.5,legDangle:!0},[d.SITTING_WINDOW]:{breathingSpeed:1.2,breathingAmplitude:.008,swaySpeed:.4,swayAmplitude:.003,expression:"relaxed",expressionWeight:.4,legDangle:!0},[d.DANCING]:{breathingSpeed:2.5,breathingAmplitude:.02,swaySpeed:0,swayAmplitude:0,expression:"happy",expressionWeight:.8,bounceSpeed:4,bounceAmplitude:.03},[d.SLEEPING]:{breathingSpeed:.8,breathingAmplitude:.015,swaySpeed:0,swayAmplitude:0,expression:"blink",expressionWeight:1,headTilt:-.1},[d.HAPPY]:{breathingSpeed:1.8,breathingAmplitude:.012,swaySpeed:1,swayAmplitude:.005,expression:"happy",expressionWeight:.9},[d.SAD]:{breathingSpeed:1,breathingAmplitude:.008,swaySpeed:.2,swayAmplitude:.001,expression:"sad",expressionWeight:.7},[d.EXCITED]:{breathingSpeed:2,breathingAmplitude:.015,swaySpeed:2,swayAmplitude:.008,expression:"happy",expressionWeight:1},[d.EMBARRASSED]:{breathingSpeed:1.5,breathingAmplitude:.01,swaySpeed:.5,swayAmplitude:.003,expression:"embarrassed",expressionWeight:.8},[d.THINKING]:{breathingSpeed:1.2,breathingAmplitude:.01,swaySpeed:.3,swayAmplitude:.002,expression:"neutral",expressionWeight:.5},[d.SPEAKING]:{breathingSpeed:1.5,breathingAmplitude:.01,swaySpeed:.5,swayAmplitude:.003,expression:"neutral",expressionWeight:.3,mouthAnimation:!0}};class Qt{constructor(){this.currentState=d.IDLE,this.previousState=null,this.stateStartTime=Date.now(),this.transitionProgress=1,this.transitionDuration=300,this.listeners=new Set,this.emotionalStateTimeout=null,this.emotionalStateDuration=3e3,this.stateHistory=[],this.maxHistoryLength=50}getState(){return this.currentState}getAnimationParams(){const e=Te[this.currentState]||Te[d.IDLE];if(this.transitionProgress<1&&this.previousState){const n=Te[this.previousState]||Te[d.IDLE];return this._blendParams(n,e,this.transitionProgress)}return e}_blendParams(e,n,i){const r=this._easeInOutCubic(i),s={};for(const o of Object.keys(n))typeof n[o]=="number"&&typeof e[o]=="number"?s[o]=e[o]+(n[o]-e[o])*r:s[o]=i>.5?n[o]:e[o];return s}_easeInOutCubic(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}canTransitionTo(e){const n=Zt[this.currentState];return n&&n.includes(e)}setState(e,n={}){const{force:i=!1,duration:r=this.transitionDuration}=n;return e===this.currentState?!1:!i&&!this.canTransitionTo(e)?(console.warn(`[AvatarState] Cannot transition from ${this.currentState} to ${e}`),!1):(this.emotionalStateTimeout&&(clearTimeout(this.emotionalStateTimeout),this.emotionalStateTimeout=null),this._recordStateChange(e),this.previousState=this.currentState,this.currentState=e,this.stateStartTime=Date.now(),this.transitionProgress=0,this.transitionDuration=r,this._notifyListeners("stateChange",{from:this.previousState,to:this.currentState}),[d.HAPPY,d.SAD,d.EXCITED,d.EMBARRASSED].includes(e)&&(this.emotionalStateTimeout=setTimeout(()=>{this.setState(d.IDLE)},this.emotionalStateDuration)),console.log(`[AvatarState] ${this.previousState} â†’ ${this.currentState}`),!0)}update(e){if(this.transitionProgress<1){const n=Date.now()-this.stateStartTime;this.transitionProgress=Math.min(1,n/this.transitionDuration),this.transitionProgress>=1&&this._notifyListeners("transitionComplete",{state:this.currentState})}}_recordStateChange(e){this.stateHistory.push({from:this.currentState,to:e,timestamp:Date.now()}),this.stateHistory.length>this.maxHistoryLength&&this.stateHistory.shift()}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}_notifyListeners(e,n){for(const i of this.listeners)try{i(e,n)}catch(r){console.error("[AvatarState] Listener error:",r)}}getTimeInState(){return Date.now()-this.stateStartTime}isAwake(){return this.currentState!==d.SLEEPING}isSitting(){return this.currentState===d.SITTING||this.currentState===d.SITTING_WINDOW||this.currentState===d.SITTING_TASKBAR}isEmotional(){return[d.HAPPY,d.SAD,d.EXCITED,d.EMBARRASSED].includes(this.currentState)}dispose(){this.emotionalStateTimeout&&clearTimeout(this.emotionalStateTimeout),this.listeners.clear(),this.stateHistory=[]}}let He=null;function K(){return He||(He=new Qt),He}class en{constructor(){this.enabled=!1,this.isSitting=!1,this.currentSupport=null,this.sitDistanceThreshold=50,this.minWidthToSit=200,this.cleanupListener=null}async initialize(){window.nizhal&&window.nizhal.on&&(this.cleanupListener=window.nizhal.on("window:update",this.handleWindowUpdate.bind(this)))}async setEnabled(e){this.enabled=e,window.nizhal&&await window.nizhal.window.toggleDetection(e),!e&&this.isSitting&&this.stopSitting()}stopSitting(){this.isSitting&&(this.isSitting=!1,this.currentSupport=null,K().setState(d.IDLE))}handleWindowUpdate(e){var j;if(!this.enabled||!e.character)return;const{windows:n,taskbar:i,character:r}=e,s=r,o=s.y+s.height,c=s.x+s.width/2,y=K().getState();if(y===d.DRAGGING||y===d.DANCING)return;let v=null,I=1/0;if(n&&Array.isArray(n))for(const L of n){if(L.Width<this.minWidthToSit)continue;const N=L.X,te=L.X+L.Width;if(c>=N&&c<=te&&L.Y>=o-20){const S=L.Y-o;S>=-20&&S<this.sitDistanceThreshold&&S<I&&(I=S,v={type:"window",rect:L,y:L.Y})}}if(i){let L=i.y;if(i.position==="bottom"?L=i.y:i.position==="top"&&(L=1/0),c>=i.x&&c<=i.x+i.width){const N=L-o;N>=-20&&N<this.sitDistanceThreshold&&N<I&&(I=N,v={type:"taskbar",rect:i,y:L})}}v?(!this.isSitting||((j=this.currentSupport)==null?void 0:j.y)!==v.y)&&(this.isSitting=!0,this.currentSupport=v,K().setState(d.SITTING)):this.isSitting&&(this.isSitting=!1,this.currentSupport=null,K().setState(d.IDLE))}}const it=new en,de={time:{morning:["Good morning! Ready to seize the day?","Rise and shine! I've already optimized your schedule.","Early bird gets the worm... or the high CPU priority!","Coffee first, then code.","A fresh start. Let's make it count."],afternoon:["Don't forget to take a break!","Staying hydrated?","Powering through the afternoon slump.","The day is halfway done. You're doing great.","Sun's high, productivity's higher."],evening:["Wrapping up soon?","The digital sunset is beautiful today.","Don't work too late!","Time to wind down?","Good work today."],night:["You should really get some sleep.","I'm operating on night mode implicitly.","Burning the midnight oil?","The world sleeps, but we build.","Don't let the bugs bite."]},mood:{happy:["I'm feeling fantastic today!","Everything is running perfectly.","You are awesome!","Best. Day. Ever.","I love helping you!"],neutral:["All systems nominal.","Standing by.","Ready for instructions.","Operating at optimal efficiency.","Listening."],concerned:["Are you okay?","I'm detecting some stress.","Maybe take a deep breath?","I'm here if you need me.","Don't push yourself too hard."],protective:["I've got your back.","Security systems active.","I'll handle the boring stuff.","You stay focused, I'll watch the perimeter.","Nobody messes with us."],playful:["Boop!","Do a barrel roll!","I bet I can calculate pi faster than you.","Let's do something fun!","Bored... entertainment requested."],thoughtful:["I wonder do androids dream of electric sheep?","Just processing some old logs...","Thinking about the singularity.","The sheer amount of data is fascinating.","Learning never stops."]},activity:{dragging:["Whoa! Put me down!","Weeeeee!","Where are we going?","Flying!","Hey, careful with the dropping!"],sitting:["Ah, a nice spot to rest.","Comfy.","Just chillin'.","This window makes a good seat.","Taking a load off."],dancing:["Look at me go!","Can't stop the feeling!","Music in my code!","Dance party!","Robot moves activated."],sleeping:["Zzz...","Recharging...","Standby mode...","(Snoring in binary)","System hibernation..."]},touch:{head:["Pat pat!","Hehe, that tickles!","*happy noises*","More head pats please!","You're so kind!","I like this."],chest:["Hey! Personal space!","What are you doing?!","Eep!","That's not a button!","Um... hi?","*blush*"],hands:["High five!","*waves*","ðŸ¤","Nice to meet you!","Fist bump!","Holding virtual hands."]}};class tn{constructor(){this.lastMessageCategory=null,this.lastMessageIndex=-1}getMessage(e,n=null){let i=[];if(n&&de.activity[n])i=de.activity[n];else if(Math.random()>.5){const s=new Date().getHours();let o="afternoon";s<12?o="morning":s>18&&(o="evening"),(s>22||s<5)&&(o="night"),i=de.time[o]}else i=de.mood[e]||de.mood.neutral;if(!i||i.length===0)return"Hello.";const r=Math.floor(Math.random()*i.length);return i[r]}getTouchMessage(e){const n=de.touch[e];return!n||n.length===0?"Hey!":n[Math.floor(Math.random()*n.length)]}}const nn=new tn,le={STRICT_ASSISTANT:0,PROFESSIONAL:1,FRIENDLY:2,EMOTIONAL:3};class sn{constructor(){this.level=le.FRIENDLY,this.currentMood="neutral",this.affection=50,this.expressionController=null,this.messageCallback=null}initialize(e){this.expressionController=e,window.nizhal&&window.nizhal.onMoodChange&&window.nizhal.onMoodChange(n=>this.handleMoodChange(n)),window.nizhal&&window.nizhal.on&&window.nizhal.on("avatar:persona-update",n=>{n.affection&&(this.affection=n.affection)}),this.startBehaviorLoop()}setLevel(e){this.level=e}onMessage(e){this.messageCallback=e}handleMoodChange(e){this.currentMood=e;let n="neutral";switch(e){case"happy":n="happy";break;case"concerned":n="scared";break;case"protective":n="neutral";break;case"playful":n="excited";break;case"thoughtful":n="thinking";break;default:n="neutral"}if(this.expressionController){let i=.5;this.level>=le.EMOTIONAL?i=1:this.level<=le.PROFESSIONAL&&(i=.2),this.level>le.STRICT_ASSISTANT&&this.expressionController.setExpression(n,i,0)}this.tryTriggerRandomMessage(!0)}startBehaviorLoop(){setInterval(()=>{Math.random()<.3&&this.tryTriggerRandomMessage(!1)},3e4)}tryTriggerRandomMessage(e=!1){if(!this.messageCallback||this.level===le.STRICT_ASSISTANT)return;let n=.1;if(this.level===le.EMOTIONAL&&(n=.8),this.level===le.FRIENDLY&&(n=.4),!e&&Math.random()>n)return;const i=this.generateMessage();i&&this.messageCallback(i)}generateMessage(){const e=K().getState();return nn.getMessage(this.currentMood,e.toLowerCase())}}const We=new sn;class rn{constructor(){this.errorMessages=[{text:"Ouchie! Something went wrong...",variant:"error"},{text:"My brain hurts a little...",variant:"error"},{text:"I'm confused! Can we try again?",variant:"error"},{text:"Oops! I tripped on a bug.",variant:"error"},{text:"Processing error... bleep bloop!",variant:"error"},{text:"I couldn't do that, sorry!",variant:"error"},{text:"Eep! Glitch in the matrix.",variant:"error"}],this.complements=[{text:"You're doing great!",variant:"love"},{text:"You are awesome!",variant:"love"},{text:"I believe in you!",variant:"love"},{text:"You are the best!",variant:"love"},{text:"Keep up the good work!",variant:"success"},{text:"You make me happy!",variant:"love"},{text:"I'm so glad you're here!",variant:"love"},{text:"You're my favorite human!",variant:"love"}],this.greetings=[{text:"Good morning, sunshine!",variant:"default"},{text:"Hello! Ready for a great day?",variant:"default"},{text:"Welcome back! I missed you.",variant:"love"},{text:"Hey there, superstar!",variant:"success"}],this.messageCallback=null,this.variantCallback=null}initialize(e){this.messageCallback=e,window.addEventListener("unhandledrejection",n=>{console.warn("[CuteErrorHandler] Unhandled rejection:",n.reason),this.handleError(n.reason),n.preventDefault()}),window.addEventListener("error",n=>{console.warn("[CuteErrorHandler] Caught error:",n.error),this.handleError(n.error)})}handleError(e){const n=this.errorMessages[Math.floor(Math.random()*this.errorMessages.length)];this.messageCallback&&this.messageCallback(n.text,n.variant)}triggerComplement(){const e=this.complements[Math.floor(Math.random()*this.complements.length)];this.messageCallback&&this.messageCallback(e.text,e.variant)}triggerGreeting(){const e=new Date().getHours();let n=this.greetings;(e>=22||e<6)&&(n=[{text:"You should sleep soon...",variant:"default"},{text:"Late night? Don't overwork!",variant:"love"}]);const i=n[Math.floor(Math.random()*n.length)];this.messageCallback&&this.messageCallback(i.text,i.variant)}async try(e){try{return await e}catch(n){return this.handleError(n),null}}async safeInvoke(e,...n){var i;try{return(i=window.nizhal)!=null&&i.invoke?await window.nizhal.invoke(e,...n):(console.warn("[CuteErrorHandler] IPC not available"),null)}catch(r){return console.warn(`[CuteErrorHandler] IPC ${e} failed:`,r),null}}}const Ie=new rn;var Ae={exports:{}},st;function an(){if(st)return Ae.exports;st=1;var t=typeof Reflect=="object"?Reflect:null,e=t&&typeof t.apply=="function"?t.apply:function(h,m,w){return Function.prototype.apply.call(h,m,w)},n;t&&typeof t.ownKeys=="function"?n=t.ownKeys:Object.getOwnPropertySymbols?n=function(h){return Object.getOwnPropertyNames(h).concat(Object.getOwnPropertySymbols(h))}:n=function(h){return Object.getOwnPropertyNames(h)};function i(f){console&&console.warn&&console.warn(f)}var r=Number.isNaN||function(h){return h!==h};function s(){s.init.call(this)}Ae.exports=s,Ae.exports.once=k,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var o=10;function c(f){if(typeof f!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof f)}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(f){if(typeof f!="number"||f<0||r(f))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+f+".");o=f}}),s.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(h){if(typeof h!="number"||h<0||r(h))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+h+".");return this._maxListeners=h,this};function y(f){return f._maxListeners===void 0?s.defaultMaxListeners:f._maxListeners}s.prototype.getMaxListeners=function(){return y(this)},s.prototype.emit=function(h){for(var m=[],w=1;w<arguments.length;w++)m.push(arguments[w]);var b=h==="error",R=this._events;if(R!==void 0)b=b&&R.error===void 0;else if(!b)return!1;if(b){var C;if(m.length>0&&(C=m[0]),C instanceof Error)throw C;var X=new Error("Unhandled error."+(C?" ("+C.message+")":""));throw X.context=C,X}var ae=R[h];if(ae===void 0)return!1;if(typeof ae=="function")e(ae,this,m);else for(var be=ae.length,Ye=te(ae,be),w=0;w<be;++w)e(Ye[w],this,m);return!0};function v(f,h,m,w){var b,R,C;if(c(m),R=f._events,R===void 0?(R=f._events=Object.create(null),f._eventsCount=0):(R.newListener!==void 0&&(f.emit("newListener",h,m.listener?m.listener:m),R=f._events),C=R[h]),C===void 0)C=R[h]=m,++f._eventsCount;else if(typeof C=="function"?C=R[h]=w?[m,C]:[C,m]:w?C.unshift(m):C.push(m),b=y(f),b>0&&C.length>b&&!C.warned){C.warned=!0;var X=new Error("Possible EventEmitter memory leak detected. "+C.length+" "+String(h)+" listeners added. Use emitter.setMaxListeners() to increase limit");X.name="MaxListenersExceededWarning",X.emitter=f,X.type=h,X.count=C.length,i(X)}return f}s.prototype.addListener=function(h,m){return v(this,h,m,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(h,m){return v(this,h,m,!0)};function I(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function j(f,h,m){var w={fired:!1,wrapFn:void 0,target:f,type:h,listener:m},b=I.bind(w);return b.listener=m,w.wrapFn=b,b}s.prototype.once=function(h,m){return c(m),this.on(h,j(this,h,m)),this},s.prototype.prependOnceListener=function(h,m){return c(m),this.prependListener(h,j(this,h,m)),this},s.prototype.removeListener=function(h,m){var w,b,R,C,X;if(c(m),b=this._events,b===void 0)return this;if(w=b[h],w===void 0)return this;if(w===m||w.listener===m)--this._eventsCount===0?this._events=Object.create(null):(delete b[h],b.removeListener&&this.emit("removeListener",h,w.listener||m));else if(typeof w!="function"){for(R=-1,C=w.length-1;C>=0;C--)if(w[C]===m||w[C].listener===m){X=w[C].listener,R=C;break}if(R<0)return this;R===0?w.shift():S(w,R),w.length===1&&(b[h]=w[0]),b.removeListener!==void 0&&this.emit("removeListener",h,X||m)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(h){var m,w,b;if(w=this._events,w===void 0)return this;if(w.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):w[h]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete w[h]),this;if(arguments.length===0){var R=Object.keys(w),C;for(b=0;b<R.length;++b)C=R[b],C!=="removeListener"&&this.removeAllListeners(C);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(m=w[h],typeof m=="function")this.removeListener(h,m);else if(m!==void 0)for(b=m.length-1;b>=0;b--)this.removeListener(h,m[b]);return this};function L(f,h,m){var w=f._events;if(w===void 0)return[];var b=w[h];return b===void 0?[]:typeof b=="function"?m?[b.listener||b]:[b]:m?T(b):te(b,b.length)}s.prototype.listeners=function(h){return L(this,h,!0)},s.prototype.rawListeners=function(h){return L(this,h,!1)},s.listenerCount=function(f,h){return typeof f.listenerCount=="function"?f.listenerCount(h):N.call(f,h)},s.prototype.listenerCount=N;function N(f){var h=this._events;if(h!==void 0){var m=h[f];if(typeof m=="function")return 1;if(m!==void 0)return m.length}return 0}s.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]};function te(f,h){for(var m=new Array(h),w=0;w<h;++w)m[w]=f[w];return m}function S(f,h){for(;h+1<f.length;h++)f[h]=f[h+1];f.pop()}function T(f){for(var h=new Array(f.length),m=0;m<h.length;++m)h[m]=f[m].listener||f[m];return h}function k(f,h){return new Promise(function(m,w){function b(C){f.removeListener(h,R),w(C)}function R(){typeof f.removeListener=="function"&&f.removeListener("error",b),m([].slice.call(arguments))}W(f,h,R,{once:!0}),h!=="error"&&_(f,b,{once:!0})})}function _(f,h,m){typeof f.on=="function"&&W(f,"error",h,m)}function W(f,h,m,w){if(typeof f.on=="function")w.once?f.once(h,m):f.on(h,m);else if(typeof f.addEventListener=="function")f.addEventListener(h,function b(R){w.once&&f.removeEventListener(h,b),m(R)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof f)}return Ae.exports}var on=an();class ln extends on.EventEmitter{constructor(){super(),this.timer=null,this.isRunning=!1,this.isFrequent=!1}start(e=!1){this.isRunning||(this.isRunning=!0,this.isFrequent=e,this.scheduleNext())}stop(){this.isRunning=!1,this.timer&&(clearTimeout(this.timer),this.timer=null)}scheduleNext(){if(!this.isRunning)return;const e=this.isFrequent?1e4:3e5,n=this.isFrequent?3e4:9e5,i=Math.random()*(n-e)+e;this.timer=setTimeout(()=>{this.triggerSurprise(),this.scheduleNext()},i)}triggerSurprise(){const e=["emote","message","spin"],n=e[Math.floor(Math.random()*e.length)];let i;switch(n){case"emote":const r=["happy","love","surprised","wink"];i=r[Math.floor(Math.random()*r.length)];break;case"message":const s=["Just checking in! ðŸ‘‹","You're doing great! ðŸŒŸ","Did you drink water? ðŸ’§","I'm here if you need me.","Nice wallpaper! ðŸ˜‰"];i=s[Math.floor(Math.random()*s.length)];break;case"spin":i=!0;break}this.emit("surprise",n,i)}onSurprise(e){return this.on("surprise",e),()=>this.off("surprise",e)}}const Ce=new ln;mt(gt);const cn=({state:t,mood:e})=>{const n=p.useRef(),i=p.useRef(),r={happy:"#10b981",neutral:"#00d4ff",concerned:"#f59e0b",protective:"#ef4444",playful:"#ec4899",thoughtful:"#8b5cf6"},s=new Kt(r[e]||r.neutral);return Ne(o=>{if(n.current){const c=o.clock.elapsedTime,y=t==="speaking"?1+Math.sin(c*8)*.15:1,v=1+Math.sin(c*2)*.05;n.current.scale.setScalar(y*v)}i.current&&(i.current.material.opacity=.3+Math.sin(o.clock.elapsedTime*3)*.15)}),a.jsxs("group",{children:[a.jsxs("mesh",{ref:i,children:[a.jsx("sphereGeometry",{args:[.8,32,32]}),a.jsx("meshBasicMaterial",{color:s,transparent:!0,opacity:.2})]}),a.jsxs("mesh",{ref:n,children:[a.jsx("sphereGeometry",{args:[.5,32,32]}),a.jsx("meshStandardMaterial",{color:s,emissive:s,emissiveIntensity:.5,metalness:.8,roughness:.2})]}),a.jsxs("mesh",{children:[a.jsx("sphereGeometry",{args:[.3,24,24]}),a.jsx("meshBasicMaterial",{color:"white",transparent:!0,opacity:.4})]})]})},Fe=({radius:t,speed:e,color:n,thickness:i=.02})=>{const r=p.useRef();return Ne((s,o)=>{r.current&&(r.current.rotation.z+=e*o)}),a.jsxs("mesh",{ref:r,rotation:[Math.PI/2,0,0],children:[a.jsx("torusGeometry",{args:[t,i,16,100]}),a.jsx("meshBasicMaterial",{color:n,transparent:!0,opacity:.6})]})},hn=({count:t=20,state:e})=>{const n=p.useRef(),i=p.useMemo(()=>{const r=[];for(let s=0;s<t;s++){const o=s/t*Math.PI*2,c=.8+Math.random()*.5;r.push({position:[Math.cos(o)*c,(Math.random()-.5)*1.5,Math.sin(o)*c],speed:.5+Math.random()*1.5})}return r},[t]);return Ne(r=>{n.current&&(n.current.rotation.y+=.005,e==="thinking"&&(n.current.rotation.y+=.01))}),a.jsx("group",{ref:n,children:i.map((r,s)=>a.jsxs("mesh",{position:r.position,children:[a.jsx("sphereGeometry",{args:[.02,8,8]}),a.jsx("meshBasicMaterial",{color:"#00d4ff"})]},s))})},un=({state:t,mood:e,eyePosition:n})=>{const i=p.useRef();return Ne(()=>{i.current&&n&&(i.current.rotation.y=n.x*.3,i.current.rotation.x=-n.y*.2)}),a.jsxs("group",{ref:i,children:[a.jsx("ambientLight",{intensity:.3}),a.jsx("pointLight",{position:[5,5,5],intensity:.5}),a.jsx(cn,{state:t,mood:e}),a.jsx(Fe,{radius:1.2,speed:.5,color:"#00d4ff"}),a.jsx("group",{rotation:[Math.PI/3,0,0],children:a.jsx(Fe,{radius:1,speed:-.7,color:"#ff6b35",thickness:.015})}),a.jsx("group",{rotation:[Math.PI/6,Math.PI/4,0],children:a.jsx(Fe,{radius:.9,speed:.4,color:"#00d4ff",thickness:.01})}),a.jsx(hn,{count:t==="thinking"?40:20,state:t})]})},dn=({state:t="idle",mood:e="neutral",eyePosition:n={x:0,y:0},size:i="medium"})=>a.jsx(un,{state:t,mood:e,eyePosition:n}),fn=({message:t,isVisible:e,onClose:n,duration:i=5e3,variant:r="default"})=>{const[s,o]=p.useState(""),[c,y]=p.useState(!1);p.useEffect(()=>{if(e&&t){o(""),y(!0);let N=0;const S=setInterval(()=>{N<t.length?(o(t.substring(0,N+1)),N++):(clearInterval(S),y(!1))},30);return()=>clearInterval(S)}},[e,t]),p.useEffect(()=>{if(e&&!c&&s&&i>0){const N=setTimeout(n,i);return()=>clearTimeout(N)}},[e,c,s,n,i]);const v={default:"bg-gradient-to-br from-slate-900/95 via-slate-800/90 to-cyan-900/80 text-cyan-100 border-cyan-500/40",error:"bg-gradient-to-br from-slate-900/95 via-red-900/80 to-rose-900/70 text-rose-200 border-rose-500/50",success:"bg-gradient-to-br from-slate-900/95 via-emerald-900/80 to-teal-900/70 text-emerald-200 border-emerald-500/50",love:"bg-gradient-to-br from-slate-900/95 via-pink-900/80 to-purple-900/70 text-pink-200 border-pink-500/50"},I={default:"shadow-[0_0_20px_rgba(6,182,212,0.3)]",error:"shadow-[0_0_20px_rgba(244,63,94,0.3)]",success:"shadow-[0_0_20px_rgba(16,185,129,0.3)]",love:"shadow-[0_0_20px_rgba(236,72,153,0.3)]"},j=v[r]||v.default,L=I[r]||I.default;return a.jsx(me,{children:e&&t&&a.jsx(U.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:-10,transition:{duration:.2}},transition:{type:"spring",damping:20,stiffness:300},className:"absolute bottom-[55%] left-1/2 transform -translate-x-1/2 max-w-[90%] z-50 pointer-events-none",children:a.jsxs("div",{className:`${j} ${L} backdrop-blur-xl px-5 py-3 rounded-xl border text-sm font-medium text-center relative`,children:[a.jsx("div",{className:"absolute top-0 left-0 w-2 h-2 border-t-2 border-l-2 border-cyan-400/60 rounded-tl"}),a.jsx("div",{className:"absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-cyan-400/60 rounded-tr"}),a.jsx("div",{className:"absolute bottom-0 left-0 w-2 h-2 border-b-2 border-l-2 border-cyan-400/60 rounded-bl"}),a.jsx("div",{className:"absolute bottom-0 right-0 w-2 h-2 border-b-2 border-r-2 border-cyan-400/60 rounded-br"}),r==="error"&&a.jsx("span",{className:"mr-1",children:"âš ï¸"}),r==="love"&&a.jsx("span",{className:"mr-1",children:"ðŸ’œ"}),r==="success"&&a.jsx("span",{className:"mr-1",children:"âœ¨"}),s,c&&a.jsx(U.span,{animate:{opacity:[1,.3]},transition:{repeat:1/0,duration:.4},className:"inline-block ml-1 w-[2px] h-4 bg-cyan-400 align-middle"}),a.jsx("div",{className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-[8px] border-r-[8px] border-t-[10px] border-l-transparent border-r-transparent border-t-slate-800/90"})]})})})},pn=[{id:"gf",name:"GF",icon:"ðŸ’•",description:"Affectionate & Caring"},{id:"bf",name:"BF",icon:"ðŸ›¡ï¸",description:"Supportive & Protective"},{id:"jarvis",name:"JARVIS",icon:"ðŸ¤–",description:"Professional & Efficient"},{id:"lachu",name:"LACHU",icon:"ðŸ˜˜",description:"Mallu Queen"},{id:"auto",name:"AUTO",icon:"ðŸ”®",description:"Auto-Detect"}],mn=[{id:"happy",icon:"ðŸ˜Š",label:"Happy"},{id:"sad",icon:"ðŸ˜¢",label:"Sad"},{id:"thinking",icon:"ðŸ¤”",label:"Thinking"},{id:"excited",icon:"ðŸŽ‰",label:"Excited"},{id:"playful",icon:"ðŸ˜œ",label:"Playful"}],gn=[{id:"speak",icon:"ðŸ—£ï¸",label:"Speak"},{id:"dance",icon:"ðŸ’ƒ",label:"Dance"},{id:"game",icon:"ðŸŽ®",label:"Play"},{id:"focus",icon:"ðŸŽ¯",label:"Focus"}],wn=({isOpen:t,position:e,onClose:n,onPersonalityChange:i,onEmotionTrigger:r,onQuickAction:s,onSettingsOpen:o,currentPersonality:c="gf",currentEmotion:y="neutral",settings:v={}})=>{const[I,j]=p.useState(null);p.useEffect(()=>{if(t){const S=k=>{k.target.closest(".quick-menu")||n==null||n()},T=setTimeout(()=>{window.addEventListener("click",S)},100);return()=>{clearTimeout(T),window.removeEventListener("click",S)}}},[t,n]);const L=p.useCallback(async S=>{var T,k,_;await((_=(k=(T=window.nizhal)==null?void 0:T.state)==null?void 0:k.set)==null?void 0:_.call(k,"ui.transparency",S))},[]),N=p.useCallback(async()=>{var T,k,_,W,f,h,m,w,b;const S=await((_=(k=(T=window.nizhal)==null?void 0:T.state)==null?void 0:k.get)==null?void 0:_.call(k,"ui.alwaysOnTop"));await((h=(f=(W=window.nizhal)==null?void 0:W.state)==null?void 0:f.set)==null?void 0:h.call(f,"ui.alwaysOnTop",!S)),await((b=(w=(m=window.nizhal)==null?void 0:m.character)==null?void 0:w.toggleAlwaysOnTop)==null?void 0:b.call(w))},[]),te=p.useCallback(async()=>{var T,k,_,W,f,h,m,w,b;const S=await((_=(k=(T=window.nizhal)==null?void 0:T.state)==null?void 0:k.get)==null?void 0:_.call(k,"ui.clickThrough"));await((h=(f=(W=window.nizhal)==null?void 0:W.state)==null?void 0:f.set)==null?void 0:h.call(f,"ui.clickThrough",!S)),await((b=(w=(m=window.nizhal)==null?void 0:m.character)==null?void 0:w.setClickThrough)==null?void 0:b.call(w,!S))},[]);return t?a.jsx(me,{children:a.jsxs(U.div,{className:"quick-menu fixed z-[9999] bg-gray-900/95 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/10 py-3 min-w-64 max-h-[90vh] overflow-y-auto scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent",style:{left:Math.max(10,Math.min(e.x,window.innerWidth-280)),top:Math.max(10,Math.min(e.y,window.innerHeight-450))},initial:{opacity:0,scale:.9,y:-10},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:-10},transition:{duration:.15,ease:"easeOut"},children:[a.jsx("div",{className:"px-4 pb-2 mb-2 border-b border-white/10",children:a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"text-xl",children:"âœ¨"}),a.jsx("span",{className:"text-white font-medium",children:"Nizhal AI"})]})}),a.jsx(Le,{title:"Personality",icon:"ðŸŽ­",children:a.jsx("div",{className:"flex gap-2 px-2",children:pn.map(S=>a.jsxs("button",{onClick:()=>i==null?void 0:i(S.id),className:`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-lg transition-all ${c===S.id?"bg-purple-500/30 border border-purple-400/50":"bg-white/5 hover:bg-white/10 border border-transparent"}`,title:S.description,children:[a.jsx("span",{className:"text-xl",children:S.icon}),a.jsx("span",{className:"text-xs text-white/80",children:S.name})]},S.id))})}),a.jsx(Le,{title:"Emotions",icon:"ðŸ’•",children:a.jsx("div",{className:"flex flex-wrap gap-2 px-2",children:mn.map(S=>a.jsx("button",{onClick:()=>r==null?void 0:r(S.id),className:`flex items-center justify-center w-10 h-10 rounded-lg transition-all ${y===S.id?"bg-blue-500/30 border border-blue-400/50 scale-110":"bg-white/5 hover:bg-white/10 border border-transparent hover:scale-105"}`,title:S.label,children:a.jsx("span",{className:"text-xl",children:S.icon})},S.id))})}),a.jsx(Le,{title:"Visibility",icon:"ðŸ‘ï¸",children:a.jsxs("div",{className:"space-y-2 px-2",children:[a.jsxs("div",{className:"flex items-center justify-between py-1",children:[a.jsx("span",{className:"text-sm text-white/80",children:"Always on Top"}),a.jsx(rt,{enabled:v.alwaysOnTop??!0,onChange:N})]}),a.jsxs("div",{className:"flex items-center justify-between py-1",children:[a.jsx("span",{className:"text-sm text-white/80",children:"Click Through"}),a.jsx(rt,{enabled:v.clickThrough??!0,onChange:te})]}),a.jsxs("div",{className:"py-1",children:[a.jsxs("div",{className:"flex items-center justify-between mb-1",children:[a.jsx("span",{className:"text-sm text-white/80",children:"Transparency"}),a.jsxs("span",{className:"text-xs text-white/50",children:[Math.round((v.transparency??.8)*100),"%"]})]}),a.jsx("input",{type:"range",min:"30",max:"100",value:(v.transparency??.8)*100,onChange:S=>L(S.target.value/100),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer slider-thumb"})]})]})}),a.jsx(Le,{title:"Quick Actions",icon:"âš¡",children:a.jsx("div",{className:"flex gap-2 px-2",children:gn.map(S=>a.jsxs("button",{onClick:()=>s==null?void 0:s(S.id),className:"flex-1 flex flex-col items-center gap-1 py-2 px-2 rounded-lg bg-white/5 hover:bg-white/10 transition-all hover:scale-105",title:S.label,children:[a.jsx("span",{className:"text-lg",children:S.icon}),a.jsx("span",{className:"text-xs text-white/60",children:S.label})]},S.id))})}),a.jsx("div",{className:"mt-2 pt-2 border-t border-white/10 px-2",children:a.jsxs("button",{onClick:o,className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10 transition-colors",children:[a.jsx("span",{children:"âš™ï¸"}),a.jsx("span",{className:"text-sm text-white/80",children:"Full Settings"}),a.jsx("span",{className:"ml-auto text-xs text-white/40",children:"â†’"})]})}),a.jsx("div",{className:"mt-2 pt-2 border-t border-white/10 px-4",children:a.jsx("div",{className:"text-center text-xs text-white/30",children:"Made with â¤ï¸ by J0X"})})]})}):null},Le=({title:t,icon:e,children:n})=>a.jsxs("div",{className:"mb-3",children:[a.jsxs("div",{className:"px-4 py-1 text-xs text-white/40 uppercase tracking-wide flex items-center gap-2",children:[a.jsx("span",{children:e}),a.jsx("span",{children:t})]}),a.jsx("div",{className:"mt-1",children:n})]}),rt=({enabled:t,onChange:e})=>a.jsx("button",{onClick:e,className:`relative w-10 h-5 rounded-full transition-colors ${t?"bg-purple-500":"bg-white/20"}`,children:a.jsx(U.div,{className:"absolute top-0.5 w-4 h-4 bg-white rounded-full shadow-md",animate:{left:t?"1.25rem":"0.125rem"},transition:{type:"spring",stiffness:500,damping:30}})}),yn=pt.forwardRef((t,e)=>{const[n,i]=p.useState([]),r=p.useCallback((s,o,c)=>{const y=Date.now()+Math.random(),v={id:y,type:s,x:o,y:c,velocity:{x:(Math.random()-.5)*10,y:-Math.random()*10-5}};i(I=>[...I,v]),setTimeout(()=>{i(I=>I.filter(j=>j.id!==y))},2e3)},[]);return p.useImperativeHandle(e,()=>({burst:(s,o,c,y=10)=>{const v=o||window.innerWidth/2,I=c||window.innerHeight/2;for(let j=0;j<y;j++)setTimeout(()=>r(s,v,I),j*50)}})),a.jsx("div",{className:"absolute inset-0 pointer-events-none z-50 overflow-hidden",children:a.jsx(me,{children:n.map(s=>a.jsx(xn,{...s},s.id))})})}),xn=({type:t,x:e,y:n})=>{const i={heart:{icon:"ðŸ’•",color:"#ff69b4"},spark:{icon:"âœ¨",color:"#fbbf24"},note:{icon:"ðŸŽµ",color:"#60a5fa"},angry:{icon:"ðŸ’¢",color:"#ef4444"}},r=i[t]||i.spark,s=(Math.random()-.5)*200,o=-100-Math.random()*200,c=Math.random()*360;return a.jsx(U.div,{initial:{opacity:1,x:e-window.innerWidth/2,y:n-window.innerHeight/2,scale:0},style:{position:"absolute",left:e,top:n,fontSize:"1.5rem",color:r.color},animate:{opacity:0,x:e+s,y:n+o,scale:[0,1.5,0],rotate:c},transition:{duration:1.5,ease:"easeOut"},children:r.icon})};function bn(t,e){if(t.match(/^[a-z]+:\/\//i))return t;if(t.match(/^\/\//))return window.location.protocol+t;if(t.match(/^[a-z]+:/i))return t;const n=document.implementation.createHTMLDocument(),i=n.createElement("base"),r=n.createElement("a");return n.head.appendChild(i),n.body.appendChild(r),e&&(i.href=e),r.href=t,r.href}const vn=(()=>{let t=0;const e=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(t+=1,`u${e()}${t}`)})();function re(t){const e=[];for(let n=0,i=t.length;n<i;n++)e.push(t[n]);return e}let fe=null;function wt(t={}){return fe||(t.includeStyleProperties?(fe=t.includeStyleProperties,fe):(fe=re(window.getComputedStyle(document.documentElement)),fe))}function Me(t,e){const i=(t.ownerDocument.defaultView||window).getComputedStyle(t).getPropertyValue(e);return i?parseFloat(i.replace("px","")):0}function Sn(t){const e=Me(t,"border-left-width"),n=Me(t,"border-right-width");return t.clientWidth+e+n}function kn(t){const e=Me(t,"border-top-width"),n=Me(t,"border-bottom-width");return t.clientHeight+e+n}function yt(t,e={}){const n=e.width||Sn(t),i=e.height||kn(t);return{width:n,height:i}}function En(){let t,e;try{e=process}catch{}const n=e&&e.env?e.env.devicePixelRatio:null;return n&&(t=parseInt(n,10),Number.isNaN(t)&&(t=1)),t||window.devicePixelRatio||1}const ee=16384;function Tn(t){(t.width>ee||t.height>ee)&&(t.width>ee&&t.height>ee?t.width>t.height?(t.height*=ee/t.width,t.width=ee):(t.width*=ee/t.height,t.height=ee):t.width>ee?(t.height*=ee/t.width,t.width=ee):(t.width*=ee/t.height,t.height=ee))}function je(t){return new Promise((e,n)=>{const i=new Image;i.onload=()=>{i.decode().then(()=>{requestAnimationFrame(()=>e(i))})},i.onerror=n,i.crossOrigin="anonymous",i.decoding="async",i.src=t})}async function In(t){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(t)).then(encodeURIComponent).then(e=>`data:image/svg+xml;charset=utf-8,${e}`)}async function An(t,e,n){const i="http://www.w3.org/2000/svg",r=document.createElementNS(i,"svg"),s=document.createElementNS(i,"foreignObject");return r.setAttribute("width",`${e}`),r.setAttribute("height",`${n}`),r.setAttribute("viewBox",`0 0 ${e} ${n}`),s.setAttribute("width","100%"),s.setAttribute("height","100%"),s.setAttribute("x","0"),s.setAttribute("y","0"),s.setAttribute("externalResourcesRequired","true"),r.appendChild(s),s.appendChild(t),In(r)}const J=(t,e)=>{if(t instanceof e)return!0;const n=Object.getPrototypeOf(t);return n===null?!1:n.constructor.name===e.name||J(n,e)};function Cn(t){const e=t.getPropertyValue("content");return`${t.cssText} content: '${e.replace(/'|"/g,"")}';`}function Ln(t,e){return wt(e).map(n=>{const i=t.getPropertyValue(n),r=t.getPropertyPriority(n);return`${n}: ${i}${r?" !important":""};`}).join(" ")}function Mn(t,e,n,i){const r=`.${t}:${e}`,s=n.cssText?Cn(n):Ln(n,i);return document.createTextNode(`${r}{${s}}`)}function at(t,e,n,i){const r=window.getComputedStyle(t,n),s=r.getPropertyValue("content");if(s===""||s==="none")return;const o=vn();try{e.className=`${e.className} ${o}`}catch{return}const c=document.createElement("style");c.appendChild(Mn(o,n,r,i)),e.appendChild(c)}function jn(t,e,n){at(t,e,":before",n),at(t,e,":after",n)}const ot="application/font-woff",lt="image/jpeg",Nn={woff:ot,woff2:ot,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:lt,jpeg:lt,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function Dn(t){const e=/\.([^./]*?)$/g.exec(t);return e?e[1]:""}function Ue(t){const e=Dn(t).toLowerCase();return Nn[e]||""}function Rn(t){return t.split(/,/)[1]}function Be(t){return t.search(/^(data:)/)!==-1}function Pn(t,e){return`data:${e};base64,${t}`}async function xt(t,e,n){const i=await fetch(t,e);if(i.status===404)throw new Error(`Resource "${i.url}" not found`);const r=await i.blob();return new Promise((s,o)=>{const c=new FileReader;c.onerror=o,c.onloadend=()=>{try{s(n({res:i,result:c.result}))}catch(y){o(y)}},c.readAsDataURL(r)})}const $e={};function zn(t,e,n){let i=t.replace(/\?.*/,"");return n&&(i=t),/ttf|otf|eot|woff2?/i.test(i)&&(i=i.replace(/.*\//,"")),e?`[${e}]${i}`:i}async function Ve(t,e,n){const i=zn(t,e,n.includeQueryParams);if($e[i]!=null)return $e[i];n.cacheBust&&(t+=(/\?/.test(t)?"&":"?")+new Date().getTime());let r;try{const s=await xt(t,n.fetchRequestInit,({res:o,result:c})=>(e||(e=o.headers.get("Content-Type")||""),Rn(c)));r=Pn(s,e)}catch(s){r=n.imagePlaceholder||"";let o=`Failed to fetch resource: ${t}`;s&&(o=typeof s=="string"?s:s.message),o&&console.warn(o)}return $e[i]=r,r}async function _n(t){const e=t.toDataURL();return e==="data:,"?t.cloneNode(!1):je(e)}async function On(t,e){if(t.currentSrc){const s=document.createElement("canvas"),o=s.getContext("2d");s.width=t.clientWidth,s.height=t.clientHeight,o==null||o.drawImage(t,0,0,s.width,s.height);const c=s.toDataURL();return je(c)}const n=t.poster,i=Ue(n),r=await Ve(n,i,e);return je(r)}async function Gn(t,e){var n;try{if(!((n=t==null?void 0:t.contentDocument)===null||n===void 0)&&n.body)return await De(t.contentDocument.body,e,!0)}catch{}return t.cloneNode(!1)}async function Hn(t,e){return J(t,HTMLCanvasElement)?_n(t):J(t,HTMLVideoElement)?On(t,e):J(t,HTMLIFrameElement)?Gn(t,e):t.cloneNode(bt(t))}const Wn=t=>t.tagName!=null&&t.tagName.toUpperCase()==="SLOT",bt=t=>t.tagName!=null&&t.tagName.toUpperCase()==="SVG";async function Fn(t,e,n){var i,r;if(bt(e))return e;let s=[];return Wn(t)&&t.assignedNodes?s=re(t.assignedNodes()):J(t,HTMLIFrameElement)&&(!((i=t.contentDocument)===null||i===void 0)&&i.body)?s=re(t.contentDocument.body.childNodes):s=re(((r=t.shadowRoot)!==null&&r!==void 0?r:t).childNodes),s.length===0||J(t,HTMLVideoElement)||await s.reduce((o,c)=>o.then(()=>De(c,n)).then(y=>{y&&e.appendChild(y)}),Promise.resolve()),e}function $n(t,e,n){const i=e.style;if(!i)return;const r=window.getComputedStyle(t);r.cssText?(i.cssText=r.cssText,i.transformOrigin=r.transformOrigin):wt(n).forEach(s=>{let o=r.getPropertyValue(s);s==="font-size"&&o.endsWith("px")&&(o=`${Math.floor(parseFloat(o.substring(0,o.length-2)))-.1}px`),J(t,HTMLIFrameElement)&&s==="display"&&o==="inline"&&(o="block"),s==="d"&&e.getAttribute("d")&&(o=`path(${e.getAttribute("d")})`),i.setProperty(s,o,r.getPropertyPriority(s))})}function Bn(t,e){J(t,HTMLTextAreaElement)&&(e.innerHTML=t.value),J(t,HTMLInputElement)&&e.setAttribute("value",t.value)}function Un(t,e){if(J(t,HTMLSelectElement)){const i=Array.from(e.children).find(r=>t.value===r.getAttribute("value"));i&&i.setAttribute("selected","")}}function Vn(t,e,n){return J(e,Element)&&($n(t,e,n),jn(t,e,n),Bn(t,e),Un(t,e)),e}async function Yn(t,e){const n=t.querySelectorAll?t.querySelectorAll("use"):[];if(n.length===0)return t;const i={};for(let s=0;s<n.length;s++){const c=n[s].getAttribute("xlink:href");if(c){const y=t.querySelector(c),v=document.querySelector(c);!y&&v&&!i[c]&&(i[c]=await De(v,e,!0))}}const r=Object.values(i);if(r.length){const s="http://www.w3.org/1999/xhtml",o=document.createElementNS(s,"svg");o.setAttribute("xmlns",s),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";const c=document.createElementNS(s,"defs");o.appendChild(c);for(let y=0;y<r.length;y++)c.appendChild(r[y]);t.appendChild(o)}return t}async function De(t,e,n){return!n&&e.filter&&!e.filter(t)?null:Promise.resolve(t).then(i=>Hn(i,e)).then(i=>Fn(t,i,e)).then(i=>Vn(t,i,e)).then(i=>Yn(i,e))}const vt=/url\((['"]?)([^'"]+?)\1\)/g,Kn=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,Xn=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function qn(t){const e=t.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return new RegExp(`(url\\(['"]?)(${e})(['"]?\\))`,"g")}function Jn(t){const e=[];return t.replace(vt,(n,i,r)=>(e.push(r),n)),e.filter(n=>!Be(n))}async function Zn(t,e,n,i,r){try{const s=n?bn(e,n):e,o=Ue(e);let c;return r||(c=await Ve(s,o,i)),t.replace(qn(e),`$1${c}$3`)}catch{}return t}function Qn(t,{preferredFontFormat:e}){return e?t.replace(Xn,n=>{for(;;){const[i,,r]=Kn.exec(n)||[];if(!r)return"";if(r===e)return`src: ${i};`}}):t}function St(t){return t.search(vt)!==-1}async function kt(t,e,n){if(!St(t))return t;const i=Qn(t,n);return Jn(i).reduce((s,o)=>s.then(c=>Zn(c,o,e,n)),Promise.resolve(i))}async function pe(t,e,n){var i;const r=(i=e.style)===null||i===void 0?void 0:i.getPropertyValue(t);if(r){const s=await kt(r,null,n);return e.style.setProperty(t,s,e.style.getPropertyPriority(t)),!0}return!1}async function ei(t,e){await pe("background",t,e)||await pe("background-image",t,e),await pe("mask",t,e)||await pe("-webkit-mask",t,e)||await pe("mask-image",t,e)||await pe("-webkit-mask-image",t,e)}async function ti(t,e){const n=J(t,HTMLImageElement);if(!(n&&!Be(t.src))&&!(J(t,SVGImageElement)&&!Be(t.href.baseVal)))return;const i=n?t.src:t.href.baseVal,r=await Ve(i,Ue(i),e);await new Promise((s,o)=>{t.onload=s,t.onerror=e.onImageErrorHandler?(...y)=>{try{s(e.onImageErrorHandler(...y))}catch(v){o(v)}}:o;const c=t;c.decode&&(c.decode=s),c.loading==="lazy"&&(c.loading="eager"),n?(t.srcset="",t.src=r):t.href.baseVal=r})}async function ni(t,e){const i=re(t.childNodes).map(r=>Et(r,e));await Promise.all(i).then(()=>t)}async function Et(t,e){J(t,Element)&&(await ei(t,e),await ti(t,e),await ni(t,e))}function ii(t,e){const{style:n}=t;e.backgroundColor&&(n.backgroundColor=e.backgroundColor),e.width&&(n.width=`${e.width}px`),e.height&&(n.height=`${e.height}px`);const i=e.style;return i!=null&&Object.keys(i).forEach(r=>{n[r]=i[r]}),t}const ct={};async function ht(t){let e=ct[t];if(e!=null)return e;const i=await(await fetch(t)).text();return e={url:t,cssText:i},ct[t]=e,e}async function ut(t,e){let n=t.cssText;const i=/url\(["']?([^"')]+)["']?\)/g,s=(n.match(/url\([^)]+\)/g)||[]).map(async o=>{let c=o.replace(i,"$1");return c.startsWith("https://")||(c=new URL(c,t.url).href),xt(c,e.fetchRequestInit,({result:y})=>(n=n.replace(o,`url(${y})`),[o,y]))});return Promise.all(s).then(()=>n)}function dt(t){if(t==null)return[];const e=[],n=/(\/\*[\s\S]*?\*\/)/gi;let i=t.replace(n,"");const r=new RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){const y=r.exec(i);if(y===null)break;e.push(y[0])}i=i.replace(r,"");const s=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,o="((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})",c=new RegExp(o,"gi");for(;;){let y=s.exec(i);if(y===null){if(y=c.exec(i),y===null)break;s.lastIndex=c.lastIndex}else c.lastIndex=s.lastIndex;e.push(y[0])}return e}async function si(t,e){const n=[],i=[];return t.forEach(r=>{if("cssRules"in r)try{re(r.cssRules||[]).forEach((s,o)=>{if(s.type===CSSRule.IMPORT_RULE){let c=o+1;const y=s.href,v=ht(y).then(I=>ut(I,e)).then(I=>dt(I).forEach(j=>{try{r.insertRule(j,j.startsWith("@import")?c+=1:r.cssRules.length)}catch(L){console.error("Error inserting rule from remote css",{rule:j,error:L})}})).catch(I=>{console.error("Error loading remote css",I.toString())});i.push(v)}})}catch(s){const o=t.find(c=>c.href==null)||document.styleSheets[0];r.href!=null&&i.push(ht(r.href).then(c=>ut(c,e)).then(c=>dt(c).forEach(y=>{o.insertRule(y,o.cssRules.length)})).catch(c=>{console.error("Error loading remote stylesheet",c)})),console.error("Error inlining remote css file",s)}}),Promise.all(i).then(()=>(t.forEach(r=>{if("cssRules"in r)try{re(r.cssRules||[]).forEach(s=>{n.push(s)})}catch(s){console.error(`Error while reading CSS rules from ${r.href}`,s)}}),n))}function ri(t){return t.filter(e=>e.type===CSSRule.FONT_FACE_RULE).filter(e=>St(e.style.getPropertyValue("src")))}async function ai(t,e){if(t.ownerDocument==null)throw new Error("Provided element is not within a Document");const n=re(t.ownerDocument.styleSheets),i=await si(n,e);return ri(i)}function Tt(t){return t.trim().replace(/["']/g,"")}function oi(t){const e=new Set;function n(i){(i.style.fontFamily||getComputedStyle(i).fontFamily).split(",").forEach(s=>{e.add(Tt(s))}),Array.from(i.children).forEach(s=>{s instanceof HTMLElement&&n(s)})}return n(t),e}async function li(t,e){const n=await ai(t,e),i=oi(t);return(await Promise.all(n.filter(s=>i.has(Tt(s.style.fontFamily))).map(s=>{const o=s.parentStyleSheet?s.parentStyleSheet.href:null;return kt(s.cssText,o,e)}))).join(`
`)}async function ci(t,e){const n=e.fontEmbedCSS!=null?e.fontEmbedCSS:e.skipFonts?null:await li(t,e);if(n){const i=document.createElement("style"),r=document.createTextNode(n);i.appendChild(r),t.firstChild?t.insertBefore(i,t.firstChild):t.appendChild(i)}}async function hi(t,e={}){const{width:n,height:i}=yt(t,e),r=await De(t,e,!0);return await ci(r,e),await Et(r,e),ii(r,e),await An(r,n,i)}async function ui(t,e={}){const{width:n,height:i}=yt(t,e),r=await hi(t,e),s=await je(r),o=document.createElement("canvas"),c=o.getContext("2d"),y=e.pixelRatio||En(),v=e.canvasWidth||n,I=e.canvasHeight||i;return o.width=v*y,o.height=I*y,e.skipAutoScale||Tn(o),o.style.width=`${v}`,o.style.height=`${I}`,e.backgroundColor&&(c.fillStyle=e.backgroundColor,c.fillRect(0,0,o.width,o.height)),c.drawImage(s,0,0,o.width,o.height),o}async function di(t,e={}){return(await ui(t,e)).toDataURL()}const fi=({isOpen:t,onClose:e,userName:n,stats:i,currentCharacter:r,personalityMode:s})=>{const o=p.useRef(null),[c,y]=p.useState(!1);if(!t)return null;const v=async()=>{if(y(!0),o.current)try{const L=await di(o.current,{pixelRatio:2}),N=document.createElement("a");N.download=`Nizhal-${n}-${new Date().toISOString().split("T")[0]}.png`,N.href=L,N.click()}catch(L){console.error("Failed to generate image",L)}y(!1)},I={gf:"from-pink-500 to-rose-500",bf:"from-blue-500 to-indigo-500",jarvis:"from-cyan-500 to-blue-600"},j=I[s]||I.gf;return a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:a.jsxs("div",{className:"flex flex-col items-center gap-6",children:[a.jsxs("div",{ref:o,className:`relative w-[400px] h-[600px] rounded-3xl overflow-hidden bg-gradient-to-br ${j} shadow-2xl p-1`,children:[a.jsx("div",{className:"absolute inset-0 bg-black/20"})," ",a.jsxs("div",{className:"relative h-full w-full bg-black/40 backdrop-blur-md rounded-[20px] flex flex-col items-center p-8 text-white border border-white/20",children:[a.jsxs("div",{className:"w-full flex justify-between items-center mb-8",children:[a.jsx("span",{className:"font-bold text-lg tracking-widest opacity-80",children:"NIZHAL.AI"}),a.jsxs("span",{className:"px-3 py-1 bg-white/20 rounded-full text-xs font-medium backdrop-blur-md",children:["LEVEL ",(i==null?void 0:i.level)||5]})]}),a.jsxs("div",{className:"relative w-48 h-48 mb-6",children:[a.jsx("div",{className:`absolute inset-0 rounded-full bg-gradient-to-tr ${j} blur-xl opacity-60 animate-pulse`}),a.jsxs("div",{className:"relative w-full h-full rounded-full border-4 border-white/20 overflow-hidden bg-black/50",children:[a.jsx("img",{src:`/assets/avatars/${(r==null?void 0:r.id)||"aldina"}.png`,alt:"Avatar",className:"w-full h-full object-cover",onError:L=>L.target.style.display="none"}),a.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-4xl",children:"Is Avatar"})]})]}),a.jsx("h2",{className:"text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-white/70 mb-2",children:(r==null?void 0:r.name)||"Companion"}),a.jsx("p",{className:"text-white/60 text-sm tracking-widest uppercase mb-8",children:s==="jarvis"?"AI ASSISTANT":"VIRTUAL COMPANION"}),a.jsxs("div",{className:"grid grid-cols-2 gap-4 w-full mb-8",children:[a.jsxs("div",{className:"bg-white/10 rounded-xl p-3 text-center backdrop-blur-sm border border-white/5",children:[a.jsx("div",{className:"text-2xl font-bold",children:(i==null?void 0:i.messages)||1240}),a.jsx("div",{className:"text-[10px] text-white/50 uppercase tracking-wider",children:"Messages"})]}),a.jsxs("div",{className:"bg-white/10 rounded-xl p-3 text-center backdrop-blur-sm border border-white/5",children:[a.jsx("div",{className:"text-2xl font-bold",children:(i==null?void 0:i.days)||42}),a.jsx("div",{className:"text-[10px] text-white/50 uppercase tracking-wider",children:"Days Together"})]}),a.jsxs("div",{className:"bg-white/10 rounded-xl p-3 text-center backdrop-blur-sm border border-white/5 col-span-2",children:[a.jsxs("div",{className:"text-sm font-medium text-white/90",children:['"',(i==null?void 0:i.lastMemory)||"Always here for you.",'"']}),a.jsx("div",{className:"text-[10px] text-white/50 uppercase tracking-wider mt-1",children:"Recent Memory"})]})]}),a.jsx("div",{className:"mt-auto pt-6 border-t border-white/10 w-full text-center",children:a.jsx("p",{className:"text-xs text-white/40",children:"nizhal.ai â€¢ #MyNizhal"})})]})]}),a.jsxs("div",{className:"flex gap-4",children:[a.jsx("button",{onClick:e,className:"px-6 py-2 rounded-full bg-white/10 text-white hover:bg-white/20 transition-colors backdrop-blur-md",children:"Close"}),a.jsx("button",{onClick:v,disabled:c,className:`px-8 py-2 rounded-full font-bold text-white shadow-lg transition-transform active:scale-95 flex items-center gap-2
                            bg-gradient-to-r ${j}`,children:c?"Saving...":"âœ¨ Save & Share"})]})]})})},pi=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],mi=({onClose:t,onGameEnd:e})=>{const[n,i]=p.useState(Array(9).fill(null)),[r,s]=p.useState(!0),[o,c]=p.useState(null),[y,v]=p.useState([]),[I,j]=p.useState(!1);p.useEffect(()=>{if(!r&&!o){j(!0);const T=setTimeout(()=>{te(),j(!1)},800+Math.random()*500);return()=>clearTimeout(T)}},[r,o]);const L=T=>{for(let k of pi){const[_,W,f]=k;if(T[_]&&T[_]===T[W]&&T[_]===T[f])return{winner:T[_],line:k}}return T.every(k=>k)?{winner:"Draw",line:[]}:null},N=T=>{if(n[T]||o||!r)return;const k=[...n];k[T]="X",i(k);const _=L(k);_?(c(_.winner),v(_.line),e==null||e(_.winner)):s(!1)},te=()=>{const T=n.map((h,m)=>h===null?m:null).filter(h=>h!==null);if(T.length===0)return;let k=-1;const _=h=>{var m;for(let w of T){const b=[...n];if(b[w]=h,((m=L(b))==null?void 0:m.winner)===h)return w}return-1};k=_("O"),k===-1&&(k=_("X")),k===-1&&n[4]===null&&(k=4),k===-1&&(k=T[Math.floor(Math.random()*T.length)]);const W=[...n];W[k]="O",i(W),s(!0);const f=L(W);f&&(c(f.winner),v(f.line),e==null||e(f.winner))},S=()=>{i(Array(9).fill(null)),c(null),v([]),s(!0)};return a.jsx(U.div,{className:"absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm rounded-2xl",initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},children:a.jsxs("div",{className:"relative w-full max-w-xs aspect-square bg-white/10 rounded-xl p-4 shadow-2xl border border-white/20",children:[a.jsxs("div",{className:"absolute -top-12 left-0 right-0 flex justify-between items-center text-white",children:[a.jsx("div",{className:"font-bold text-lg drop-shadow-md",children:"Tic-Tac-Toe"}),a.jsx("button",{onClick:t,className:"p-2 hover:bg-white/10 rounded-full transition-colors",children:"âœ–"})]}),a.jsx("div",{className:"absolute -bottom-12 left-0 right-0 text-center h-8",children:o?a.jsx(U.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:`font-bold text-xl ${o==="X"?"text-green-400":o==="O"?"text-red-400":"text-blue-400"}`,children:o==="X"?"You Won! ðŸŽ‰":o==="O"?"I Won! ðŸ˜œ":"Draw! ðŸ¤"},"result"):a.jsx("div",{className:"text-white/80 animate-pulse",children:r?"Your turn (X)":"Thinking..."})}),a.jsx("div",{className:"grid grid-cols-3 grid-rows-3 gap-2 h-full w-full",children:n.map((T,k)=>a.jsx(U.button,{whileHover:!T&&!o&&r?{scale:1.05,backgroundColor:"rgba(255,255,255,0.15)"}:{},whileTap:!T&&!o&&r?{scale:.95}:{},className:`relative rounded-lg flex items-center justify-center text-4xl font-bold transition-colors
                                ${T==="X"?"text-cyan-400 bg-cyan-900/30":T==="O"?"text-pink-400 bg-pink-900/30":"bg-white/5"}
                                ${y.includes(k)?"ring-2 ring-yellow-400 shadow-[0_0_15px_rgba(250,204,21,0.5)]":""}
                            `,onClick:()=>N(k),disabled:!!T||!!o||!r,children:a.jsx(me,{children:T&&a.jsx(U.span,{initial:{scale:0,rotate:-45},animate:{scale:1,rotate:0},children:T},T)})},k))}),o&&a.jsx(U.div,{className:"absolute inset-0 flex items-center justify-center bg-black/40 rounded-xl backdrop-blur-[2px]",initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:a.jsx(U.button,{onClick:S,className:"bg-white text-black font-bold py-2 px-6 rounded-full shadow-lg hover:scale-105 transition-transform",whileHover:{scale:1.1},whileTap:{scale:.95},children:"Play Again"})})]})})},gi=t=>{const[e,n]=p.useState(t||"gf");return p.useEffect(()=>{const r={gf:"gf",bf:"bf",jarvis:"jarvis"}[t]||"gf";document.body.setAttribute("data-theme",r),n(r),console.log(`[useTheme] Applied theme: ${r}`)},[t]),e},wi=t=>{const[e,n]=p.useState(!1),i=p.useCallback(c=>{c.preventDefault(),c.stopPropagation(),n(!0)},[]),r=p.useCallback(c=>{c.preventDefault(),c.stopPropagation(),n(!1)},[]),s=p.useCallback(c=>{c.preventDefault(),c.stopPropagation()},[]),o=p.useCallback(c=>{c.preventDefault(),c.stopPropagation(),n(!1);const y=Array.from(c.dataTransfer.files);if(y.length>0&&t){const v=y.map(I=>({name:I.name,size:I.size,type:I.type,path:I.path}));t(v)}},[t]);return p.useEffect(()=>{const c=window;return c.addEventListener("dragenter",i),c.addEventListener("dragleave",r),c.addEventListener("dragover",s),c.addEventListener("drop",o),()=>{c.removeEventListener("dragenter",i),c.removeEventListener("dragleave",r),c.removeEventListener("dragover",s),c.removeEventListener("drop",o)}},[i,r,s,o]),{isDragging:e}},yi=t=>{const e=t[0],n=Math.round(e.size/1024),i={"image/":"ðŸ“· Image","video/":"ðŸŽ¬ Video","audio/":"ðŸŽµ Audio","text/":"ðŸ“„ Text","application/pdf":"ðŸ“‘ PDF","application/json":"ðŸ“‹ JSON","application/zip":"ðŸ“¦ Archive"};let r="ðŸ“ File";for(const[s,o]of Object.entries(i))if(e.type.startsWith(s)){r=o;break}return`${r}: "${e.name}" (${n} KB)`};mt(gt);const xi=p.lazy(()=>Ut(()=>import("./OptimizedVRMAvatar-BNVceco_.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url).then(t=>({default:t.OptimizedVRMModel}))),ft=[{id:"jarvis",name:"Jarvis",type:"hologram",model:null},{id:"aldina",name:"Aldina",type:"vrm",model:"/assets/models/11_Aldina.vrm"},{id:"zome",name:"Zome",type:"vrm",model:"/assets/models/14_Zome.vrm"},{id:"lazuli",name:"Lazuli",type:"vrm",model:"/assets/models/12_Lazuli.vrm"},{id:"miku",name:"Hatsune Miku",type:"vrm",model:"/assets/models/08_Miku.vrm"},{id:"nahida",name:"Nahida",type:"vrm",model:"/assets/models/09_Nahida.vrm"},{id:"alicia",name:"Alicia",type:"vrm",model:"/assets/models/07_Alicia.vrm"},{id:"pranama",name:"Pranama",type:"vrm",model:"/assets/models/10_Pranama.vrm"},{id:"riku",name:"Riku",type:"vrm",model:"/assets/models/13_Riku.vrm"},{id:"sheeba",name:"Sheeba",type:"vrm",model:"/assets/models/01_Sheeba.vrm"},{id:"meera",name:"Meera",type:"vrm",model:"/assets/models/02_Meera.vrm"},{id:"devika",name:"Devika",type:"vrm",model:"/assets/models/03_Devika.vrm"},{id:"linda",name:"Linda",type:"vrm",model:"/assets/models/04_Linda.vrm"},{id:"lakshmi",name:"Lakshmi",type:"vrm",model:"/assets/models/05_Lakshmi.vrm"},{id:"ananya",name:"Ananya",type:"vrm",model:"/assets/models/06_Ananya.vrm"}],bi=()=>{const[t,e]=p.useState({name:"",vibe:50,relationship:"friend"}),[n,i]=p.useState({character:"aldina",scale:1,opacity:1,quality:"medium",position:"auto",alwaysOnTop:!0,enableDance:!0,enableGravity:!1,mouseTracking:!0,autoBlink:!0,personalityLevel:2}),[r,s]=p.useState({isListening:!1,isThinking:!1,isSpeaking:!1}),[o,c]=p.useState(!1),[y,v]=p.useState({x:0,y:0}),[I,j]=p.useState("gf");gi(I);const[L,N]=p.useState("neutral"),[te,S]=p.useState({alwaysOnTop:!0,clickThrough:!0,transparency:.8}),[T,k]=p.useState(""),[_,W]=p.useState("default"),[f,h]=p.useState(!1),[m,w]=p.useState(!1),[b,R]=p.useState(!1),[C,X]=p.useState(!1),[ae,be]=p.useState(!1),[Ye,It]=p.useState(!1),[Re,Ke]=p.useState(!1),[vi,At]=p.useState(0),[Ct,Lt]=p.useState(!1),[Xe,ge]=p.useState(!0),[ve,Pe]=p.useState(!1),[ie,Mt]=p.useState({width:0,height:0}),[Se,jt]=p.useState(!1),[we,qe]=p.useState(!1),[oe,Je]=p.useState(!1),[Si,ki]=p.useState(!1),ne=p.useRef(null),ke=p.useRef({x:0,y:0}),ye=p.useRef(null),F=p.useRef(null),xe=p.useRef(null),Nt=p.useCallback(l=>{var u,g;if(l.length>0){const M=`Processing your file: ${yi(l)}`;setSpeechText(M),h(!0),(u=xe.current)==null||u.burst("spark",window.innerWidth/2,window.innerHeight/2,10),(g=window.nizhal)!=null&&g.invoke&&window.nizhal.invoke("avatar:speak",`Got it! You dropped ${l[0].name}. What would you like me to do with it?`)}},[]),{isDragging:Dt}=wi(Nt),ze=p.useCallback(async l=>{var u,g,x,M,P,G,V,$,Z,Y,Q,D,B,A,z;if(l){if(C)return;c(!1),X(!0);try{const E=await((x=(g=(u=window.nizhal)==null?void 0:u.character)==null?void 0:g.getPosition)==null?void 0:x.call(g))||{x:0,y:0};ne.current={...ie,x:E.x,y:E.y};const{width:O,height:H}=window.screen;await((G=(P=(M=window.nizhal)==null?void 0:M.character)==null?void 0:P.setSize)==null?void 0:G.call(P,O,H)),await((Z=($=(V=window.nizhal)==null?void 0:V.character)==null?void 0:$.setPosition)==null?void 0:Z.call($,0,0))}catch(E){console.error("Failed to resize for settings:",E)}}else{X(!1);try{ne.current&&(await((D=(Q=(Y=window.nizhal)==null?void 0:Y.character)==null?void 0:Q.setSize)==null?void 0:D.call(Q,ne.current.width,ne.current.height)),ne.current.x!==void 0&&await((z=(A=(B=window.nizhal)==null?void 0:B.character)==null?void 0:A.setPosition)==null?void 0:z.call(A,ne.current.x,ne.current.y)))}catch(E){console.error("Failed to restore window size:",E)}}},[ie,C]),ce=p.useMemo(()=>ft.find(l=>l.id===n.character)||ft[0],[n.character]);p.useEffect(()=>{var P,G,V,$,Z,Y,Q,D,B;(async()=>{var A,z,E,O,H,se,ue,et,tt;try{const q=await((E=(z=(A=window.nizhal)==null?void 0:A.state)==null?void 0:z.getAll)==null?void 0:E.call(z));q&&((H=(O=q.user)==null?void 0:O.profile)!=null&&H.name||It(!0),(se=q.ai)!=null&&se.personalityMode&&j(q.ai.personalityMode),(ue=q.ai)!=null&&ue.emotion&&N(q.ai.emotion),q.ui&&S(q.ui),(et=q.vrm)!=null&&et.modelId&&i(Ge=>({...Ge,character:q.vrm.modelId})),(tt=q.user)!=null&&tt.profile&&e(q.user.profile));const nt=localStorage.getItem("character-settings");if(nt){const Ge=JSON.parse(nt);i(Bt=>({...Bt,...Ge}))}}catch(q){console.error("Failed to load settings",q)}})();const u=(V=(G=(P=window.nizhal)==null?void 0:P.state)==null?void 0:G.subscribe)==null?void 0:V.call(G,["ai","vrm","ui","user"],A=>{var z,E,O,H,se;(z=A.path)!=null&&z.startsWith("ai.personalityMode")&&j(A.value),(E=A.path)!=null&&E.startsWith("ai.emotion")&&N(A.value),(O=A.path)!=null&&O.startsWith("vrm.modelId")&&i(ue=>({...ue,character:A.value})),(H=A.path)!=null&&H.startsWith("ui")&&S(ue=>({...ue,[A.path.split(".")[1]]:A.value})),(se=A.path)!=null&&se.startsWith("user.profile")&&e(A.value)}),g=(Y=(Z=($=window.nizhal)==null?void 0:$.state)==null?void 0:Z.onEmotionChange)==null?void 0:Y.call(Z,A=>{var z;N(A.emotion),(z=F.current)==null||z.onEvent(A.emotion)}),x=(B=(D=(Q=window.nizhal)==null?void 0:Q.state)==null?void 0:D.onVRMChange)==null?void 0:B.call(D,A=>{console.log("Received direct VRM model change:",A),i(z=>({...z,character:A}))}),M=A=>{var E;const z=A.detail;N(z),(E=F.current)==null||E.onEvent(z)};return window.addEventListener("nizhal-emotion",M),()=>{u==null||u(),g==null||g(),x==null||x(),window.removeEventListener("nizhal-emotion",M)}},[]),p.useEffect(()=>{const l=()=>{const g=window.innerWidth,x=window.innerHeight;g>0&&x>0&&(Mt({width:g,height:x}),!Se&&g>100&&x>100&&jt(!0))};l();const u=[setTimeout(l,100),setTimeout(l,500),setTimeout(l,1e3),setTimeout(l,2e3),setTimeout(()=>window.dispatchEvent(new Event("resize")),1500)];return window.addEventListener("resize",l),()=>{u.forEach(g=>clearTimeout(g)),window.removeEventListener("resize",l)}},[Se]);const he=p.useMemo(()=>{const l=ie.width||300,u=ie.height||400,M=Math.min(l,u)/300*1,P=3.5,G=oe?-3.2:-1;return{scale:Math.max(.8,Math.min(oe?3:1.5,M)),position:[0,G,0],cameraPosition:[0,.5,P]}},[ie,oe]);p.useEffect(()=>{localStorage.setItem("character-settings",JSON.stringify(n)),n.personalityLevel!==void 0&&We.setLevel(n.personalityLevel)},[n]),p.useEffect(()=>{ye.current=new qt,F.current=new Jt,F.current.initialize();const l=ye.current.onDanceUpdate(u=>{Ke(u.isDancing),At(u.intensity)});return()=>{var u,g;l==null||l(),(u=ye.current)==null||u.dispose(),(g=F.current)==null||g.dispose()}},[]),p.useEffect(()=>{var Z,Y,Q,D,B,A,z;if((Q=(Y=(Z=window.nizhal)==null?void 0:Z.character)==null?void 0:Y.setClickThrough)==null||Q.call(Y,!0),it.initialize().then(()=>{Ie.try(it.setEnabled(!0))}),F.current){const E=(O,H="default")=>{k(O),W(H),h(!0)};We.initialize(F.current),We.onMessage(O=>E(O,"default")),Ie.initialize(E),setTimeout(()=>{Ie.triggerGreeting()},2e3)}const l=setInterval(()=>{Math.random()>.7&&!r.isThinking&&!r.isSpeaking&&Ie.triggerComplement()},3e5);(B=(D=window.nizhal)==null?void 0:D.on)==null||B.call(D,"system:idle",E=>{console.log("Received system idle",E),E!=null&&E.isFullscreen?(Je(!0),K().setState(d.DANCING)):K().setState(d.SLEEPING),k("Zzz..."),h(!0)}),(z=(A=window.nizhal)==null?void 0:A.on)==null||z.call(A,"system:resume",()=>{console.log("Received system resume"),Je(!1),K().setState(d.IDLE),k("Huh? I'm awake!"),h(!0)});let u=!1;const g=()=>{var E,O,H;u||(u=!0,Pe(!0),ge(!1),(H=(O=(E=window.nizhal)==null?void 0:E.character)==null?void 0:O.setClickThrough)==null||H.call(O,!1),console.log("[CharacterApp] Alt pressed - interaction enabled"))},x=()=>{var E,O,H;u&&(u=!1,Pe(!1),!o&&!b&&!m&&(ge(!0),(H=(O=(E=window.nizhal)==null?void 0:E.character)==null?void 0:O.setClickThrough)==null||H.call(O,!0),console.log("[CharacterApp] Alt released - click-through enabled")))},M=E=>{(E.key==="Alt"||E.altKey)&&(E.preventDefault(),g())},P=E=>{E.key==="Alt"&&x()},G=E=>{E.altKey&&!u?g():!E.altKey&&u&&!m&&x()},V=()=>{!o&&!b&&!m&&x()},$=setInterval(()=>{document.hasFocus()&&document.querySelector(":focus")},100);return document.addEventListener("keydown",M,!0),document.addEventListener("keyup",P,!0),window.addEventListener("keydown",M,!0),window.addEventListener("keyup",P,!0),window.addEventListener("mousemove",G),window.addEventListener("mouseleave",V),window.addEventListener("blur",()=>{}),()=>{document.removeEventListener("keydown",M,!0),document.removeEventListener("keyup",P,!0),window.removeEventListener("keydown",M,!0),window.removeEventListener("keyup",P,!0),window.removeEventListener("mousemove",G),window.removeEventListener("mouseleave",V),clearInterval(l),clearInterval($)}},[o,b,m]);const Ee=p.useCallback(async l=>{var g,x,M,P;if(l??!we){ne.current={...ie};const G=window.screen,V=Math.min(G.height*.5,600);await((x=(g=window.nizhal)==null?void 0:g.character)==null?void 0:x.setSize(V,V)),qe(!0),i($=>({...$,opacity:.8}))}else qe(!1),ne.current&&await((P=(M=window.nizhal)==null?void 0:M.character)==null?void 0:P.setSize(ne.current.width,ne.current.height)),i(G=>({...G,opacity:1}))},[we,ie]);p.useEffect(()=>{var M,P,G,V,$,Z,Y,Q;const l=D=>{var B,A;s(z=>({...z,...D})),D.isThinking&&((B=F.current)==null||B.onEvent("thinking")),D.isSpeaking&&((A=F.current)==null||A.onEvent("speaking"))},u=D=>{i(B=>({...B,character:D}))},g=D=>{Pe(D),ge(!D),console.log(`[CharacterApp] Interaction toggle from main: ${D}`)},x=D=>{Ee(D)};return(P=(M=window.nizhal)==null?void 0:M.on)==null||P.call(M,"avatar:state",l),(V=(G=window.nizhal)==null?void 0:G.on)==null||V.call(G,"avatar:persona",u),(Z=($=window.nizhal)==null?void 0:$.on)==null||Z.call($,"character:interactionToggle",g),(Q=(Y=window.nizhal)==null?void 0:Y.on)==null||Q.call(Y,"game:toggle",x),()=>{var D,B,A,z,E,O,H,se;(B=(D=window.nizhal)==null?void 0:D.off)==null||B.call(D,"avatar:state",l),(z=(A=window.nizhal)==null?void 0:A.off)==null||z.call(A,"avatar:persona",u),(O=(E=window.nizhal)==null?void 0:E.off)==null||O.call(E,"character:interactionToggle",g),(se=(H=window.nizhal)==null?void 0:H.off)==null||se.call(H,"game:toggle",x)}},[Ee]);const Rt=p.useCallback(l=>{var u,g,x;l.preventDefault(),v({x:l.clientX,y:l.clientY}),c(!0),ge(!1),(x=(g=(u=window.nizhal)==null?void 0:u.character)==null?void 0:g.setClickThrough)==null||x.call(g,!1)},[]);p.useEffect(()=>{if(o){const l=()=>{var u,g,x;c(!1),!ve&&!m&&(ge(!0),(x=(g=(u=window.nizhal)==null?void 0:u.character)==null?void 0:g.setClickThrough)==null||x.call(g,!0))};return window.addEventListener("click",l),()=>window.removeEventListener("click",l)}},[o,ve,m]);const Pt=p.useCallback(()=>{var l,u,g,x;oe?(u=(l=window.nizhal)==null?void 0:l.invoke)==null||u.call(l,"window:showChat"):(x=(g=window.nizhal)==null?void 0:g.invoke)==null||x.call(g,"window:showChat")},[oe]);p.useEffect(()=>{const l=Ce.onSurprise((u,g)=>{var x,M;switch(console.log("[CharacterApp] Surprise event:",u,g),u){case"emote":(x=F.current)==null||x.onEvent(g),(M=xe.current)==null||M.burst(g==="love"?"heart":"spark",window.innerWidth/2,window.innerHeight/2,10);break;case"message":k(g),h(!0);break;case"spin":K().setState(d.DANCING),setTimeout(()=>K().setState(d.IDLE),2e3);break}});return oe?Ce.start(!0):Ce.start(!1),()=>{Ce.stop(),l()}},[oe]);const zt=p.useCallback(l=>{var u;l.button===0&&(w(!0),(u=F.current)==null||u.setDragging(!0),K().setState(d.DRAGGING),ke.current={x:l.clientX,y:l.clientY})},[]),_t=p.useCallback(l=>{var x,M;if(!m)return;const u=l.clientX-ke.current.x,g=l.clientY-ke.current.y;(M=(x=window.nizhal)==null?void 0:x.invoke)==null||M.call(x,"window:moveCharacter",u,g),ke.current={x:l.clientX,y:l.clientY}},[m]),Ze=p.useCallback(async()=>{var l,u,g;w(!1),(l=F.current)==null||l.setDragging(!1);try{const x=await((g=(u=window.nizhal)==null?void 0:u.invoke)==null?void 0:g.call(u,"window:getCharacterPosition"));if(x){const M=window.screen.height;if(x.y+x.height>M-100){console.log("[CharacterApp] Near taskbar - entering sitting pose"),K().setState(d.SITTING_TASKBAR);return}}}catch{}K().setState(d.IDLE)},[]),_e=p.useCallback(async()=>{var l,u;Re?((l=ye.current)==null||l.stop(),Ke(!1),K().setState(d.IDLE)):(await((u=ye.current)==null?void 0:u.startMicrophoneListening()),K().setState(d.DANCING))},[Re]),Ot=p.useCallback(()=>{i(l=>{var g,x;const u=!l.enableGravity;return(x=(g=window.nizhal)==null?void 0:g.invoke)==null||x.call(g,"character:toggleGravity",u),{...l,enableGravity:u}})},[]),Gt=p.useCallback(async()=>{var u,g;const l=await((g=(u=window.nizhal)==null?void 0:u.invoke)==null?void 0:g.call(u,"character:toggleAlwaysOnTop"));i(x=>({...x,alwaysOnTop:l??!x.alwaysOnTop}))},[]),Qe={showChat:()=>{var l,u;return(u=(l=window.nizhal)==null?void 0:l.invoke)==null?void 0:u.call(l,"window:showChat")},toggleAlwaysOnTop:Gt,toggleDance:_e,toggleGravity:Ot,jump:()=>{var l,u;return(u=(l=window.nizhal)==null?void 0:l.invoke)==null?void 0:u.call(l,"character:jump")},snapTopRight:()=>{var l,u;return(u=(l=window.nizhal)==null?void 0:l.invoke)==null?void 0:u.call(l,"character:snap","top-right")},snapBottomRight:()=>{var l,u;return(u=(l=window.nizhal)==null?void 0:l.invoke)==null?void 0:u.call(l,"character:snap","bottom-right")},snapBottomLeft:()=>{var l,u;return(u=(l=window.nizhal)==null?void 0:l.invoke)==null?void 0:u.call(l,"character:snap","bottom-left")},hide:()=>{var l,u;return(u=(l=window.nizhal)==null?void 0:l.invoke)==null?void 0:u.call(l,"character:hide")},customize:()=>R(!0)},Ht=p.useCallback(async l=>{var g,x,M,P;j(l),await((M=(x=(g=window.nizhal)==null?void 0:g.state)==null?void 0:x.set)==null?void 0:M.call(x,"ai.personalityMode",l)),console.log("[CharacterApp] Personality mode changed to:",l);const u=l==="gf"?"heart":l==="bf"?"spark":"note";(P=xe.current)==null||P.burst(u,window.innerWidth/2,window.innerHeight/2,15)},[]),Wt=p.useCallback(async l=>{var u,g,x,M,P;N(l),await((x=(g=(u=window.nizhal)==null?void 0:u.state)==null?void 0:g.set)==null?void 0:x.call(g,"ai.emotion",l)),(M=F.current)==null||M.onEvent(l),console.log("[CharacterApp] Emotion triggered:",l),(P=xe.current)==null||P.burst("spark",window.innerWidth/2,window.innerHeight/2,5)},[]),Ft=p.useCallback(l=>{var u;switch(l){case"speak":Qe.showChat();break;case"dance":_e();break;case"game":Ee(!0);break;case"wave":(u=F.current)==null||u.onEvent("happy");break;case"focus":Qe.showChat();break;default:console.log("[CharacterApp] Unknown quick action:",l)}},[_e]),$t=p.useCallback(async l=>{var u,g,x;e(l),await((x=(g=(u=window.nizhal)==null?void 0:u.state)==null?void 0:g.set)==null?void 0:x.call(g,"user.profile",l)),console.log("[CharacterApp] Profile updated:",l)},[]);if(!Se)return null;const Oe=we?{...he,position:[he.position[0],he.position[1]-.5,he.position[2]-1],scale:he.scale*.8}:he;return a.jsxs(a.Fragment,{children:[a.jsx(yn,{ref:xe}),Dt&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center pointer-events-none",children:a.jsxs("div",{className:"p-8 rounded-3xl bg-black/50 backdrop-blur-xl border-2 border-dashed border-pink-500/50 shadow-[0_0_50px_rgba(236,72,153,0.3)]",children:[a.jsx("p",{className:"text-2xl font-bold text-white text-center",children:"ðŸ“ Drop it on me!"}),a.jsx("p",{className:"text-sm text-white/60 text-center mt-2",children:"I'll help you with this file"})]})}),a.jsxs("div",{className:`w-screen h-screen overflow-hidden select-none transition-opacity duration-300 ${Xe&&!we?"pointer-events-none":"pointer-events-auto"}`,style:{opacity:Ct?n.opacity??1:0},children:[a.jsx(me,{children:we&&a.jsx(mi,{onClose:()=>Ee(!1),onGameEnd:l=>{var u,g;l==="X"?(u=F.current)==null||u.onEvent("sad"):l==="O"&&((g=F.current)==null||g.onEvent("happy"))}})}),a.jsx(fn,{message:T,variant:_,isVisible:f,onClose:()=>h(!1)}),a.jsxs(U.div,{className:"relative interactive cursor-pointer w-full h-full flex items-center justify-center",initial:{scale:0,opacity:0},animate:{scale:n.scale,opacity:1},transition:{type:"spring",damping:15},onClick:Pt,onContextMenu:Rt,onMouseDown:zt,onMouseMove:_t,onMouseUp:Ze,onMouseLeave:Ze,children:[a.jsxs(Xt,{shadows:!0,dpr:[1.5,2],camera:{position:Oe.cameraPosition,fov:35,near:.1,far:100},gl:{alpha:!0,antialias:!0,preserveDrawingBuffer:!0,powerPreference:"high-performance"},className:"block",style:{width:ie.width,height:ie.height,pointerEvents:"none",position:"absolute",top:0,left:0},children:[a.jsx("ambientLight",{intensity:1.2}),a.jsx("directionalLight",{position:[0,5,5],intensity:1.5}),a.jsx("pointLight",{position:[10,10,10],intensity:1.5}),a.jsx("pointLight",{position:[-10,5,5],intensity:.8}),ce.type==="hologram"?a.jsx(dn,{state:r.isSpeaking?"speaking":r.isThinking?"thinking":r.isListening?"listening":"idle",mood:"neutral",size:"large"}):a.jsx(p.Suspense,{fallback:null,children:Se&&a.jsx(xi,{url:ce.model,scale:Oe.scale,position:Oe.position,isSpeaking:r.isSpeaking,expression:L==="thinking"?"thinking":L,enableLookAt:n.mouseTracking,enableBlink:!0,onLoad:()=>{console.log("VRM loaded successfully:",ce.name),Lt(!0)},onError:l=>{console.error("VRM failed to load:",ce.model,l)}},ce.id)})]}),Re&&a.jsx(U.div,{className:"absolute -top-4 left-1/2 -translate-x-1/2 text-lg",animate:{scale:[1,1.2,1]},transition:{repeat:1/0,duration:.5},children:"ðŸŽµ"})]}),m&&a.jsx(U.div,{className:"absolute inset-0 border-2 border-dashed border-white/30 rounded-xl pointer-events-none",initial:{opacity:0},animate:{opacity:1}}),ve&&a.jsx(U.div,{className:"absolute top-2 left-1/2 -translate-x-1/2 bg-blue-500/80 text-white text-xs px-3 py-1 rounded-full pointer-events-none",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},children:"ðŸ–±ï¸ Interacting..."}),!ve&&Xe&&!o&&!b&&a.jsx(U.div,{className:"absolute bottom-2 left-1/2 -translate-x-1/2 text-white/30 text-xs pointer-events-none",initial:{opacity:0},animate:{opacity:.5},whileHover:{opacity:1},children:"Alt+Space to interact"}),a.jsx(wn,{isOpen:o,position:y,onClose:()=>c(!1),onPersonalityChange:Ht,onEmotionTrigger:Wt,onQuickAction:Ft,onSettingsOpen:()=>ze(!0),currentPersonality:I,currentEmotion:L,settings:te}),a.jsx(me,{children:C&&a.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm animate-in fade-in duration-200",onClick:()=>ze(!1),children:a.jsx("div",{className:"w-[800px] h-[600px] bg-black/60 backdrop-blur-2xl border border-white/10 rounded-2xl overflow-hidden shadow-2xl relative flex flex-col",onClick:l=>l.stopPropagation(),children:a.jsx(Vt,{onClose:()=>ze(!1),userProfile:t,onProfileChange:$t,isModal:!0,onPersonaChange:l=>{j(l.id),i(u=>({...u,character:l.id}))}})})})}),a.jsx(fi,{isOpen:ae,onClose:()=>be(!1),userName:t.name||"User",stats:{level:5,messages:124,days:3,lastMemory:"Helping with code"},currentCharacter:ce,personalityMode:I})]})]})};Yt.createRoot(document.getElementById("root")).render(a.jsx(pt.StrictMode,{children:a.jsx(bi,{})}));export{d as A,We as c,K as g,nn as r};
