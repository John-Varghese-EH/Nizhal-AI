class s{constructor(){this.baseUrl="https://api.open-meteo.com/v1/forecast",this.cache=null,this.lastFetch=0}async resolveLocation(t){try{const o=await(await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(t)}&count=1&language=en&format=json`)).json();if(o.results&&o.results.length>0){const e=o.results[0];return{lat:e.latitude,lon:e.longitude,name:`${e.name}, ${e.country_code}`.toUpperCase()}}throw new Error("City not found")}catch(r){return console.error("[WeatherService] Geocoding failed:",r),null}}async getWeather(t=9.9312,r=76.2673,o="Kochi, IN"){const e=`${t},${r}`,c=Date.now();if(this.cache&&this.cache.key===e&&c-this.lastFetch<900*1e3)return console.log("[Weather] Serving from cache"),this.cache.data;try{console.log(`[Weather] Fetching for ${o}...`);const n=`${this.baseUrl}?latitude=${t}&longitude=${r}&current=temperature_2m,weather_code,relative_humidity_2m&daily=temperature_2m_max,temperature_2m_min&timezone=auto`,a=await(await fetch(n)).json();if(!a.current)throw new Error("Invalid weather data");const i={temp:Math.round(a.current.temperature_2m),condition:this.decodeWeatherCode(a.current.weather_code),humidity:a.current.relative_humidity_2m,high:Math.round(a.daily.temperature_2m_max[0]),low:Math.round(a.daily.temperature_2m_min[0]),location:o,isMock:!1};return this.cache={key:e,data:i},this.lastFetch=c,i}catch(n){return console.error("[WeatherService] Fetch failed:",n),{temp:28,condition:"Sunny",humidity:75,high:32,low:26,location:"Offline",isMock:!0}}}decodeWeatherCode(t){return{0:"Clear Sky",1:"Mainly Clear",2:"Partly Cloudy",3:"Overcast",45:"Fog",48:"Fog",51:"Drizzle",53:"Drizzle",55:"Drizzle",61:"Rain",63:"Rain",65:"Heavy Rain",71:"Snow",95:"Thunderstorm"}[t]||"Unknown"}}const u=new s;export{s as WeatherService,u as weatherService};
