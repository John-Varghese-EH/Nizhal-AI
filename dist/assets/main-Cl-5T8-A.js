import{_ as ke,R as Ce}from"./globals-B0QoFA28.js";import{j as e,m,A as Z}from"./animation-Bl1i2YEf.js";import{a as o,R as Me,B as ze}from"./react-vendor-DIqo-C3o.js";import{e as be,C as ve,u as J,a as X,R as Se,D as Ie,S as Ae,b as Te,T as ye,W as Pe,H as Ee,L as ue,c as Le,F as Re,d as me,A as _e,M as $e,P as Oe}from"./three-xLF7kgIl.js";import{_ as Fe,O as He}from"./OrbitControls-ChSUc3J3.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),De=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(t,i,a)=>a?a.toUpperCase():i.toLowerCase()),xe=r=>{const t=De(r);return t.charAt(0).toUpperCase()+t.slice(1)},je=(...r)=>r.filter((t,i,a)=>!!t&&t.trim()!==""&&a.indexOf(t)===i).join(" ").trim(),Ve=r=>{for(const t in r)if(t.startsWith("aria-")||t==="role"||t==="title")return!0};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ge={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=o.forwardRef(({color:r="currentColor",size:t=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:s="",children:l,iconNode:h,...c},f)=>o.createElement("svg",{ref:f,...Ge,width:t,height:t,stroke:r,strokeWidth:a?Number(i)*24/Number(t):i,className:je("lucide",s),...!l&&!Ve(c)&&{"aria-hidden":"true"},...c},[...h.map(([N,j])=>o.createElement(N,j)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=(r,t)=>{const i=o.forwardRef(({className:a,...s},l)=>o.createElement(We,{ref:l,iconNode:t,className:je(`lucide-${Be(xe(r))}`,`lucide-${r}`,a),...s}));return i.displayName=xe(r),i};/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],Ke=L("activity",Ue);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qe=[["path",{d:"M14.564 14.558a3 3 0 1 1-4.122-4.121",key:"1rnrzw"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M20 20H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 .819-.175",key:"1x3arw"}],["path",{d:"M9.695 4.024A2 2 0 0 1 10.004 4h3.993a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v7.344",key:"1i84u0"}]],pe=L("camera-off",qe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["path",{d:"M13.997 4a2 2 0 0 1 1.76 1.05l.486.9A2 2 0 0 0 18.003 7H20a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h1.997a2 2 0 0 0 1.759-1.048l.489-.904A2 2 0 0 1 10.004 4z",key:"18u6gg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]],Ze=L("camera",Je);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ye=L("circle-alert",Qe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],et=L("copy",Xe);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tt=[["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M17 20v2",key:"1rnc9c"}],["path",{d:"M17 2v2",key:"11trls"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M2 17h2",key:"7oei6x"}],["path",{d:"M2 7h2",key:"asdhe0"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"M20 17h2",key:"1fpfkl"}],["path",{d:"M20 7h2",key:"1o8tra"}],["path",{d:"M7 20v2",key:"4gnj0m"}],["path",{d:"M7 2v2",key:"1i4yhu"}],["rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",key:"1vbyd7"}],["rect",{x:"8",y:"8",width:"8",height:"8",rx:"1",key:"z9xiuo"}]],st=L("cpu",tt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const at=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]],it=L("mic-off",at);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nt=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],rt=L("mic",nt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ot=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],lt=L("power",ot);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],fe=L("refresh-cw",ct);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ht=L("settings",dt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=[["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M5 5a1 1 0 0 0-1 1v7c0 5 3.5 7.5 7.67 8.94a1 1 0 0 0 .67.01c2.35-.82 4.48-1.97 5.9-3.71",key:"1jlk70"}],["path",{d:"M9.309 3.652A12.252 12.252 0 0 0 11.24 2.28a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1v7a9.784 9.784 0 0 1-.08 1.264",key:"18rp1v"}]],mt=L("shield-off",ut);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],de=L("shield",xt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ft=L("video-off",pt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]],wt=L("video",gt);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bt=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],vt=L("wifi",bt),yt=({personaName:r,clickThrough:t,onClickThroughToggle:i,onMaximize:a,privacyMode:s})=>{const l=()=>{var f;return(f=window.nizhal)==null?void 0:f.window.minimize()},h=()=>{var f;a?a():(f=window.nizhal)==null||f.window.maximize()},c=()=>{var f;return(f=window.nizhal)==null?void 0:f.window.close()};return e.jsxs("div",{className:"h-12 flex items-center justify-between px-4 drag-region bg-slate-900/50 border-b border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3 no-drag",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${s?"bg-green-400":"bg-cyan-400"} animate-pulse`}),e.jsx("span",{className:"text-sm font-light tracking-wider text-white",children:r}),s&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-0.5 bg-green-500/10 border border-green-500/30 rounded-full",children:[e.jsx(de,{size:10,className:"text-green-400"}),e.jsx("span",{className:"text-[9px] text-green-400 font-mono",children:"LOCAL"})]})]}),e.jsxs("div",{className:"flex items-center gap-1 no-drag",children:[e.jsx(m.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:i,className:`p-1.5 rounded-lg transition-colors ${t?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"hover:bg-white/10 text-slate-400"}`,title:t?"Disable Click-Through":"Enable Click-Through",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:t?"M15 12a3 3 0 11-6 0 3 3 0 016 0z M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z":"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M3 3l18 18"})})}),e.jsx(m.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:l,className:"p-1.5 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white",title:"Minimize",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),e.jsx(m.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:h,className:"p-1.5 rounded-lg hover:bg-white/10 text-slate-400 hover:text-white",title:"Maximize to full dashboard",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),e.jsx(m.button,{whileHover:{scale:1.1,backgroundColor:"rgba(239, 68, 68, 0.3)"},whileTap:{scale:.9},onClick:c,className:"p-1.5 rounded-lg hover:bg-red-500/20 text-slate-400 hover:text-red-400",title:"Close",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]})},Ne=({persona:r,personalityState:t})=>{const[i,a]=o.useState([]),[s,l]=o.useState(""),[h,c]=o.useState(!1),[f,N]=o.useState(!1),j=o.useRef(null),u=o.useRef(null);o.useEffect(()=>{y()},[]),o.useEffect(()=>{g()},[i]);const y=async()=>{var w;try{const p=await((w=window.nizhal)==null?void 0:w.memory.getHistory(20));if(p&&p.length>0){const k=p.flatMap(S=>[{role:"user",content:S.userMessage,timestamp:S.timestamp},{role:"assistant",content:S.aiResponse,timestamp:S.timestamp}]);a(k)}else a([{role:"assistant",content:C(),timestamp:Date.now()}])}catch(p){console.error("Failed to load history:",p)}},C=()=>({jarvis:"Good day. I am at your service. How may I assist you?",bestie:"Hey! How are you doing? I'm here for you, let's chat! â¤ï¸",buddy:"Hey bro! What's up? I'm ready to help!"})[r==null?void 0:r.id]||"Hello! I'm Nizhal AI. How can I help you today?",g=()=>{var w;(w=j.current)==null||w.scrollIntoView({behavior:"smooth"})},z=async w=>{var k,S,T;if(w.preventDefault(),!s.trim()||h)return;const p=s.trim();l(""),a(I=>[...I,{role:"user",content:p,timestamp:Date.now()}]),c(!0),N(!0);try{const I=await((k=window.nizhal)==null?void 0:k.ai.chat(p));if(I!=null&&I.success){a(B=>[...B,{role:"assistant",content:I.response,timestamp:Date.now()}]);const M=await((S=window.nizhal)==null?void 0:S.memory.getUserPreferences());M!=null&&M.voiceEnabled&&await((T=window.nizhal)==null?void 0:T.voice.speak(I.response))}else a(M=>[...M,{role:"assistant",content:(I==null?void 0:I.error)||"I encountered an issue. Please try again.",timestamp:Date.now(),isError:!0}])}catch(I){console.error("Chat error:",I),a(M=>[...M,{role:"assistant",content:"Connection error. Please check your AI provider settings.",timestamp:Date.now(),isError:!0}])}finally{c(!1),N(!1)}},x=()=>({happy:"ðŸ˜Š",neutral:"ðŸ¤–",concerned:"ðŸ˜Ÿ",protective:"ðŸ›¡ï¸",playful:"ðŸ˜„",thoughtful:"ðŸ¤”"})[t==null?void 0:t.mood]||"ðŸ¤–";return e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[e.jsx(Z,{initial:!1,children:i.map((w,p)=>e.jsx(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.3},className:`flex ${w.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-2xl px-4 py-3 ${w.role==="user"?"bg-indigo-600 text-white rounded-br-sm":w.isError?"bg-red-500/20 text-red-300 border border-red-500/30 rounded-bl-sm":"bg-white/10 text-white/90 rounded-bl-sm"}`,children:[w.role==="assistant"&&!w.isError&&e.jsxs("div",{className:"flex items-center gap-2 mb-1 text-xs text-white/50",children:[e.jsx("span",{children:x()}),e.jsx("span",{children:(r==null?void 0:r.name)||"AI"})]}),e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:w.content})]})},p))}),f&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"flex justify-start",children:e.jsx("div",{className:"bg-white/10 rounded-2xl rounded-bl-sm px-4 py-3",children:e.jsx("div",{className:"flex gap-1",children:[0,1,2].map(w=>e.jsx(m.div,{className:"w-2 h-2 bg-indigo-400 rounded-full",animate:{y:[0,-8,0]},transition:{duration:.6,repeat:1/0,delay:w*.1}},w))})})}),e.jsx("div",{ref:j})]}),e.jsx("form",{onSubmit:z,className:"p-4 border-t border-white/5",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:u,type:"text",value:s,onChange:w=>l(w.target.value),placeholder:`Message ${(r==null?void 0:r.name)||"AI"}...`,disabled:h,className:"flex-1 bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white placeholder-white/30 focus:outline-none focus:border-indigo-500/50 focus:ring-1 focus:ring-indigo-500/30 transition-all disabled:opacity-50"}),e.jsx(m.button,{type:"submit",disabled:h||!s.trim(),whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-4 py-3 bg-indigo-600 hover:bg-indigo-700 disabled:bg-white/10 rounded-xl transition-colors disabled:cursor-not-allowed",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})})})]})})]})},jt=({onBack:r})=>{var g,z;const[t,i]=o.useState([]),[a,s]=o.useState(null),[l,h]=o.useState(!1),[c,f]=o.useState(null),[N,j]=o.useState(!0);o.useEffect(()=>{u()},[]);const u=async()=>{var x;try{const w=await((x=window.nizhal)==null?void 0:x.marketplace.getPersonas());i(w||[])}catch(w){console.error("Failed to load personas:",w)}finally{j(!1)}},y=async(x,w)=>{var p;h(!0),f(null);try{const k=await((p=window.nizhal)==null?void 0:p.marketplace.purchase(x,w));f(k),k!=null&&k.success&&await u()}catch(k){f({success:!1,error:k.message})}finally{h(!1)}},C=x=>{const w={free:"bg-green-500/20 text-green-400 border-green-500/30",pro:"bg-purple-500/20 text-purple-400 border-purple-500/30",elite:"bg-amber-500/20 text-amber-400 border-amber-500/30",ultimate:"bg-rose-500/20 text-rose-400 border-rose-500/30"};return w[x]||w.free};return N?e.jsx("div",{className:"h-full flex items-center justify-center",children:e.jsx(m.div,{className:"w-10 h-10 border-3 border-indigo-500 border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})}):e.jsxs("div",{className:"h-full flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/5",children:[e.jsx("h2",{className:"text-lg font-semibold gradient-text",children:"Persona Marketplace"}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Unlock new companions and features"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:t.map(x=>e.jsxs(m.div,{layoutId:x.id,whileHover:{scale:1.02},onClick:()=>s(x),className:"bg-white/5 rounded-xl p-4 border border-white/10 cursor-pointer hover:border-indigo-500/50 transition-all",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-medium text-white",children:x.name}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full border ${C(x.tier)}`,children:x.tier.toUpperCase()}),x.unlocked&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-green-500/20 text-green-400",children:"âœ“ Owned"})]}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:x.description})]}),!x.unlocked&&x.price&&e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-bold text-indigo-400",children:["$",x.price.usd]}),e.jsxs("div",{className:"text-xs text-white/40",children:["â‚¹",x.price.inr]})]})]}),x.features&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-3",children:x.features.slice(0,3).map((w,p)=>e.jsx("span",{className:"text-xs bg-white/5 px-2 py-1 rounded-md text-white/60",children:w},p))})]},x.id))}),e.jsx(Z,{children:a&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:()=>s(null),children:e.jsxs(m.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:x=>x.stopPropagation(),className:"bg-gray-900 rounded-2xl p-6 max-w-sm w-full border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:a.name}),e.jsx("button",{onClick:()=>s(null),className:"p-1 hover:bg-white/10 rounded-lg transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-white/60",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("p",{className:"text-sm text-white/60 mb-4",children:a.description}),a.features&&e.jsx("div",{className:"space-y-2 mb-6",children:a.features.map((x,w)=>e.jsxs("div",{className:"flex items-center gap-2 text-sm text-white/80",children:[e.jsx("svg",{className:"w-4 h-4 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),x]},w))}),c&&e.jsx("div",{className:`mb-4 p-3 rounded-lg text-sm ${c.success?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:c.success?"âœ“ Purchase successful! Persona unlocked.":c.cancelled?"Purchase cancelled.":`Error: ${c.error}`}),a.unlocked?e.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{var x;(x=window.nizhal)==null||x.persona.setActive(a.id),s(null)},className:"w-full py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-xl transition-colors",children:"Activate Persona"}):a.tier==="free"?e.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{var x;(x=window.nizhal)==null||x.persona.setActive(a.id),s(null)},className:"w-full py-3 bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-xl transition-colors",children:"Use Now (Free)"}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>y(a.id,"razorpay"),disabled:l,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-700 text-white font-medium rounded-xl transition-colors flex items-center justify-center gap-2",children:l?e.jsx(m.div,{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}}):e.jsxs(e.Fragment,{children:["Pay â‚¹",(g=a.price)==null?void 0:g.inr," (India)"]})}),e.jsxs(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>y(a.id,"stripe"),disabled:l,className:"w-full py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-gray-700 text-white font-medium rounded-xl transition-colors",children:["Pay $",(z=a.price)==null?void 0:z.usd," (International)"]})]})]})})})]})},Nt=({onBack:r,onPersonaChange:t,privacyMode:i,onPrivacyToggle:a})=>{var te,se,ae,ie,ne;const[s,l]=o.useState({}),[h,c]=o.useState([]),[f,N]=o.useState("jarvis"),[j,u]=o.useState(!1),[y,C]=o.useState(null),[g,z]=o.useState(""),[x,w]=o.useState([]),[p,k]=o.useState(null),[S,T]=o.useState("general");o.useEffect(()=>{I()},[]);const I=async()=>{var n,d,b,v,A;try{const _=await((n=window.nizhal)==null?void 0:n.memory.getUserPreferences()),$=await((d=window.nizhal)==null?void 0:d.persona.getAll()),R=await((b=window.nizhal)==null?void 0:b.persona.getActive()),F=await((v=window.nizhal)==null?void 0:v.ai.getProviders()),q=await((A=window.nizhal)==null?void 0:A.ai.getProviderStatus());l(_||{}),c($||[]),N((R==null?void 0:R.id)||"jarvis"),w(F||[]),k(q||{})}catch(_){console.error("Failed to load settings:",_)}},M=async(n,d)=>{var b;u(!0);try{const v={...s,[n]:d};await((b=window.nizhal)==null?void 0:b.memory.setUserPreferences(v)),l(v)}catch(v){console.error("Failed to save preference:",v)}finally{u(!1)}},B=async n=>{var d;try{const b=await((d=window.nizhal)==null?void 0:d.persona.setActive(n));N(n),t==null||t(b)}catch(b){console.error("Failed to switch persona:",b)}},D=async()=>{var n,d,b,v;if(!(!y||!g.trim())){u(!0);try{const A={...s.apiKeys,[y]:g.trim()};await((n=window.nizhal)==null?void 0:n.memory.setUserPreferences({apiKeys:A})),l(R=>({...R,apiKeys:A})),await((d=window.nizhal)==null?void 0:d.ai.setProvider(y,{apiKey:g.trim()}));const _=await((b=window.nizhal)==null?void 0:b.ai.getProviderStatus()),$=await((v=window.nizhal)==null?void 0:v.ai.getProviders());k(_),w($),C(null),z("")}catch(A){console.error("Failed to save API key:",A)}finally{u(!1)}}},G=async n=>{var d,b;u(!0);try{await((d=window.nizhal)==null?void 0:d.ai.setProvider(n,{})),await M("aiProvider",n);const v=await((b=window.nizhal)==null?void 0:b.ai.getProviderStatus());k(v)}catch(v){console.error("Failed to set provider:",v)}finally{u(!1)}},Q=async n=>{var d,b;try{await((d=window.nizhal)==null?void 0:d.ai.setFallbackEnabled(n)),await M("enableFallback",n);const v=await((b=window.nizhal)==null?void 0:b.ai.getProviderStatus());k(v)}catch(v){console.error("Failed to toggle fallback:",v)}},Y=async()=>{var b,v;const n=await((b=window.nizhal)==null?void 0:b.ai.checkLocalAI()),d=await((v=window.nizhal)==null?void 0:v.ai.getProviderStatus());return k(d),n},O=n=>{var d;(d=window.nizhal)==null||d.app.openExternal(n)},E=({label:n,description:d,children:b})=>e.jsxs("div",{className:"flex items-center justify-between py-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:n}),d&&e.jsx("div",{className:"text-xs text-white/40 mt-0.5",children:d})]}),e.jsx("div",{className:"flex-shrink-0",children:b})]}),P=({enabled:n,onChange:d})=>e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>d(!n),className:`relative w-12 h-6 rounded-full transition-colors ${n?"bg-indigo-600":"bg-white/20"}`,children:e.jsx(m.div,{className:"absolute top-1 w-4 h-4 bg-white rounded-full",animate:{left:n?"26px":"4px"},transition:{type:"spring",stiffness:500,damping:30}})}),ee=({available:n,configured:d})=>n?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-green-400",children:[e.jsx("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})," Connected"]}):d?e.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-yellow-400",children:[e.jsx("span",{className:"w-2 h-2 bg-yellow-400 rounded-full"})," Configured"]}):e.jsxs("span",{className:"flex items-center gap-1.5 text-xs text-white/30",children:[e.jsx("span",{className:"w-2 h-2 bg-white/30 rounded-full"})," Not set"]}),W=({id:n,label:d,active:b})=>e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>T(n),className:`px-4 py-2 text-sm font-medium rounded-lg transition-colors ${b?"bg-indigo-600 text-white":"text-white/60 hover:text-white hover:bg-white/5"}`,children:d}),K=[{id:"gemini",name:"Google Gemini",description:"Free tier available",url:"https://aistudio.google.com/app/apikey"},{id:"openai",name:"OpenAI",description:"GPT-4o models",url:"https://platform.openai.com/api-keys"},{id:"anthropic",name:"Anthropic",description:"Claude models",url:"https://console.anthropic.com/settings/keys"},{id:"elevenlabs",name:"ElevenLabs",description:"Premium voice synthesis",url:"https://elevenlabs.io/api"}];return e.jsxs("div",{className:"h-full flex flex-col overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-white/5",children:[e.jsx("h2",{className:"text-lg font-semibold gradient-text",children:"Settings"}),e.jsx("p",{className:"text-xs text-white/50 mt-1",children:"Customize your Nizhal AI experience"})]}),e.jsxs("div",{className:"px-4 py-2 flex gap-2 border-b border-white/5 overflow-x-auto",children:[e.jsx(W,{id:"general",label:"General",active:S==="general"}),e.jsx(W,{id:"character",label:"Character",active:S==="character"}),e.jsx(W,{id:"ai",label:"AI Providers",active:S==="ai"}),e.jsx(W,{id:"voice",label:"Voice",active:S==="voice"}),e.jsx(W,{id:"shortcuts",label:"Shortcuts",active:S==="shortcuts"})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>O("https://www.buymeacoffee.com/nizhalai"),className:"w-full py-4 px-4 bg-gradient-to-r from-amber-500 to-orange-500 rounded-xl flex items-center justify-center gap-3 text-white font-medium shadow-lg shadow-orange-500/25",children:[e.jsx("svg",{className:"w-6 h-6",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.527.404-.675.701-.154.316-.199.66-.267 1-.069.34-.176.707-.135 1.056.087.753.613 1.365 1.37 1.502a39.69 39.69 0 0011.343.376.483.483 0 01.535.53l-.071.697-1.018 9.907c-.041.41-.047.832-.125 1.237-.122.637-.553 1.028-1.182 1.171-.577.131-1.165.185-1.756.205-.656.023-1.313-.019-1.969-.062-.661-.043-1.32-.104-1.979-.176-.289-.032-.554-.146-.7-.427-.148-.283-.148-.621-.085-.926.111-.533.32-1.017.596-1.468a21.265 21.265 0 011.783-2.456c.299-.355.614-.697.922-1.045.079-.09.154-.185.232-.276.208-.243.189-.589-.074-.773-.25-.175-.582-.137-.822.101-.336.334-.666.673-.988 1.021a23.234 23.234 0 00-2.189 2.851c-.431.66-.781 1.374-.975 2.148-.104.413-.143.846-.07 1.265.074.423.261.807.536 1.113.493.55 1.2.786 1.923.88.749.097 1.507.117 2.261.106.774-.012 1.549-.068 2.319-.16.696-.083 1.39-.206 2.03-.486.574-.252 1.112-.671 1.359-1.273.148-.358.215-.747.268-1.13l.052-.426c.015-.116.029-.232.041-.347l.902-8.765c.028-.266.058-.532.088-.797l.035-.318.024-.2.025-.236.034-.315.018-.162.009-.083c.005-.044.011-.088.016-.131.053-.441-.291-.844-.753-.918a43.422 43.422 0 01-2.693-.448 38.69 38.69 0 01-2.443-.55c-.212-.057-.424-.116-.636-.177-.146-.042-.293-.084-.439-.127-.072-.021-.143-.043-.213-.064-.034-.011-.067-.021-.1-.031h-.003l-.265-.082-.13-.041-.014-.004h-.002l-.016-.005-.028-.009-.064-.02a.486.486 0 01-.332-.597l.008-.027.016-.051.014-.046.01-.034c.112-.378.226-.757.35-1.132.132-.398.274-.793.433-1.18.083-.204.172-.405.266-.603a.514.514 0 01.456-.279h.005l.009.001.027.002.064.007.13.013.279.03c.147.016.294.031.442.046l.451.044c.149.014.298.028.448.041l.444.04c.147.012.294.024.442.035l.435.032.43.03.426.028.42.026.414.024.408.022.4.02.392.018.384.016.375.013.366.011.357.01h.346l.337.005h.656l.316-.003.306-.006z"})}),"Sponsor Nizhal AI â˜•"]}),e.jsxs(Z,{mode:"wait",children:[S==="general"&&e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70 mb-3",children:"Active Persona"}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:h.map(n=>e.jsxs(m.button,{whileTap:{scale:.95},onClick:()=>B(n.id),className:`p-3 rounded-xl text-center transition-all ${f===n.id?"bg-indigo-600 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,children:[e.jsx("div",{className:"text-2xl mb-1",children:{jarvis:"ðŸ¤–",kavya:"âœ¨",arjun:"ðŸ›¡ï¸",naruto:"ðŸ¦Š",goku:"ðŸ‰",elsa:"â„ï¸",tamil_nanban:"ðŸŽ­",telugu_sneham:"ðŸ¤",hindi_dost:"ðŸ•º"}[n.id]||"ðŸ‘¤"}),e.jsx("div",{className:"text-xs font-medium truncate",children:n.name})]},n.id))})]}),e.jsxs("div",{className:"space-y-1 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70 mb-3",children:"General"}),e.jsx(E,{label:"Voice Output",description:"Enable AI speech responses",children:e.jsx(P,{enabled:s.voiceEnabled,onChange:n=>M("voiceEnabled",n)})}),e.jsx(E,{label:"Always on Top",description:"Keep window above others",children:e.jsx(P,{enabled:s.alwaysOnTop,onChange:n=>{var d;M("alwaysOnTop",n),(d=window.nizhal)==null||d.window.setAlwaysOnTop(n)}})}),e.jsx(E,{label:"Start with Windows",description:"Launch on system startup",children:e.jsx(P,{enabled:s.startWithWindows,onChange:n=>M("startWithWindows",n)})}),e.jsx(E,{label:"Privacy Mode",description:"Local-only AI (blocks cloud connections)",children:e.jsx(P,{enabled:i,onChange:a})})]}),e.jsxs("div",{className:"border-t border-white/5 pt-4 space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Support & Links"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>O("https://patreon.com/nizhalai"),className:"p-3 bg-orange-500/10 border border-orange-500/20 rounded-xl text-orange-400 text-sm font-medium",children:"Patreon"}),e.jsx(m.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>O("https://github.com/nizhal-ai"),className:"p-3 bg-white/5 border border-white/10 rounded-xl text-white/70 text-sm font-medium",children:"GitHub"})]})]})]},"general"),S==="character"&&e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Character Model"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:[{id:"jarvis",name:"Jarvis",icon:"ðŸ”®",desc:"Hologram"},{id:"zome",name:"Zome",icon:"ðŸ‘§",desc:"VRM"},{id:"lazuli",name:"Lazuli",icon:"ðŸ’«",desc:"VRM"},{id:"aldina",name:"Aldina",icon:"ðŸŒ¸",desc:"VRM"}].map(n=>e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>{var d,b,v;M("characterModel",n.id),(v=(b=(d=window.nizhal)==null?void 0:d.character)==null?void 0:b.setModel)==null||v.call(b,n.id)},className:`p-3 rounded-xl text-left transition-all ${s.characterModel===n.id?"bg-indigo-600/30 border-2 border-indigo-500":"bg-white/5 border border-white/10 hover:bg-white/10"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-2xl",children:n.icon}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:n.name}),e.jsx("div",{className:"text-xs text-white/40",children:n.desc})]})]})},n.id))})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Display"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-white/60",children:"Size"}),e.jsxs("span",{className:"text-white/40",children:[(s.characterScale||1).toFixed(1),"x"]})]}),e.jsx("input",{type:"range",min:"0.5",max:"2",step:"0.1",value:s.characterScale||1,onChange:n=>M("characterScale",parseFloat(n.target.value)),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-white/60",children:"Opacity"}),e.jsxs("span",{className:"text-white/40",children:[Math.round((s.characterOpacity||1)*100),"%"]})]}),e.jsx("input",{type:"range",min:"0.3",max:"1",step:"0.1",value:s.characterOpacity||1,onChange:n=>M("characterOpacity",parseFloat(n.target.value)),className:"w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer accent-indigo-500"})]}),e.jsx("div",{className:"flex gap-2",children:["low","medium","high"].map(n=>e.jsxs("button",{className:`flex-1 py-2 rounded-lg text-xs capitalize ${s.characterQuality===n?"bg-indigo-500/30 text-white":"bg-white/5 text-white/60 hover:bg-white/10"}`,onClick:()=>M("characterQuality",n),children:[n," Quality"]},n))})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Behavior"}),e.jsx(E,{label:"Enable Gravity",description:"Character falls and sits on taskbar",children:e.jsx(P,{enabled:s.enableGravity,onChange:n=>M("enableGravity",n)})}),e.jsx(E,{label:"Dance to Music",description:"Responds to audio beats",children:e.jsx(P,{enabled:s.enableDance!==!1,onChange:n=>M("enableDance",n)})}),e.jsx(E,{label:"Mouse Tracking",description:"Eyes follow cursor",children:e.jsx(P,{enabled:s.mouseTracking!==!1,onChange:n=>M("mouseTracking",n)})}),e.jsx(E,{label:"Auto Blink",description:"Natural blinking animation",children:e.jsx(P,{enabled:s.autoBlink!==!1,onChange:n=>M("autoBlink",n)})})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Quick Position"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{pos:"top-left",icon:"â†–ï¸"},{pos:"top-right",icon:"â†—ï¸"},{pos:"bottom-left",icon:"â†™ï¸"},{pos:"bottom-right",icon:"â†˜ï¸"}].map(({pos:n,icon:d})=>e.jsx("button",{className:"p-2 bg-white/5 hover:bg-white/10 rounded-lg text-lg",onClick:()=>{var b,v,A;return(A=(v=(b=window.nizhal)==null?void 0:b.character)==null?void 0:v.snap)==null?void 0:A.call(v,n)},children:d},n))})]})]},"character"),S==="ai"&&e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[e.jsxs("div",{className:"p-4 rounded-xl bg-gradient-to-br from-indigo-500/10 to-purple-500/10 border border-indigo-500/20",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-white",children:"Active Provider"}),e.jsx("span",{className:"text-xs px-2 py-1 bg-indigo-500/20 text-indigo-300 rounded-full",children:(p==null?void 0:p.currentProvider)||"auto"})]}),e.jsx("p",{className:"text-xs text-white/50",children:p!=null&&p.ollamaAvailable?"âœ“ Local AI available":"âœ— Local AI not running, using cloud providers"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Local AI (Ollama)"}),e.jsx(m.button,{whileTap:{scale:.95},onClick:Y,className:"text-xs text-indigo-400 hover:text-indigo-300",children:"Refresh Status"})]}),e.jsxs("div",{className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${p!=null&&p.ollamaAvailable?"bg-green-500/20":"bg-white/10"}`,children:e.jsx("span",{className:"text-xl",children:"ðŸ¦™"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Ollama"}),e.jsx("div",{className:"text-xs text-white/40",children:"Free, private, runs locally"})]})]}),e.jsx(ee,{available:p==null?void 0:p.ollamaAvailable,configured:!0})]}),!(p!=null&&p.ollamaAvailable)&&e.jsxs("div",{className:"mt-3 p-3 rounded-lg bg-yellow-500/10 border border-yellow-500/20",children:[e.jsx("p",{className:"text-xs text-yellow-300 mb-2",children:"Ollama is not running. Start it for free local AI:"}),e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>O("https://ollama.com"),className:"text-xs text-yellow-400 underline",children:"Download Ollama â†’"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Cloud Providers"}),e.jsx("div",{className:"space-y-2",children:x.filter(n=>n.id!=="ollama").map(n=>e.jsxs(m.div,{whileHover:{backgroundColor:"rgba(255,255,255,0.05)"},className:"p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${n.available?"bg-green-500/20":"bg-white/10"}`,children:[n.id==="gemini"&&e.jsx("span",{className:"text-xl",children:"âœ¨"}),n.id==="openai"&&e.jsx("span",{className:"text-xl",children:"ðŸ¤–"}),n.id==="anthropic"&&e.jsx("span",{className:"text-xl",children:"ðŸ§ "})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:n.name}),e.jsx("div",{className:"text-xs text-white/40",children:n.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(ee,{available:n.available,configured:n.configured}),e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>{var d;C(n.id),z(((d=s.apiKeys)==null?void 0:d[n.id])||"")},className:"text-xs px-3 py-1.5 bg-white/10 hover:bg-white/20 rounded-lg text-white/70",children:n.configured?"Edit":"Add Key"})]})]}),n.configured&&(p==null?void 0:p.currentProvider)!==n.id&&e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>G(n.id),className:"mt-3 w-full py-2 text-xs bg-indigo-500/20 hover:bg-indigo-500/30 text-indigo-300 rounded-lg",children:"Use as Primary"})]},n.id))})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Fallback Settings"}),e.jsx(E,{label:"Automatic Fallback",description:"Try other providers if primary fails",children:e.jsx(P,{enabled:(p==null?void 0:p.fallbackEnabled)??!0,onChange:Q})}),e.jsx("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:e.jsxs("p",{className:"text-xs text-white/50",children:["Priority: ",((te=p==null?void 0:p.providerPriority)==null?void 0:te.join(" â†’ "))||"ollama â†’ gemini â†’ openai â†’ anthropic"]})})]})]},"ai"),S==="voice"&&e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Voice Input"}),e.jsx(E,{label:"Voice Commands",description:"Use microphone to talk to AI",children:e.jsx(P,{enabled:s.voiceInputEnabled,onChange:n=>M("voiceInputEnabled",n)})}),e.jsx(E,{label:"Wake Word",description:'Say "Hey Nizhal" to activate',children:e.jsx(P,{enabled:s.wakeWordEnabled,onChange:n=>M("wakeWordEnabled",n)})}),e.jsxs("div",{className:"p-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("p",{className:"text-xs text-white/50 mb-2",children:"Supported languages:"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:["English","Malayalam","Hindi","Tamil","Telugu"].map(n=>e.jsx("span",{className:"text-xs px-2 py-1 bg-white/10 rounded text-white/60",children:n},n))})]})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Voice Output"}),e.jsx(E,{label:"Enable Speech",description:"AI speaks responses aloud",children:e.jsx(P,{enabled:s.voiceEnabled,onChange:n=>M("voiceEnabled",n)})})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Premium Voice (ElevenLabs)"}),e.jsxs(m.button,{whileHover:{backgroundColor:"rgba(255,255,255,0.05)"},onClick:()=>{var n;C("elevenlabs"),z(((n=s.apiKeys)==null?void 0:n.elevenlabs)||"")},className:"w-full flex items-center justify-between p-4 rounded-xl bg-white/5 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${(se=s.apiKeys)!=null&&se.elevenlabs?"bg-green-500/20":"bg-white/10"}`,children:e.jsx("span",{className:"text-xl",children:"ðŸŽ™ï¸"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"ElevenLabs API"}),e.jsx("div",{className:"text-xs text-white/40",children:"Ultra-realistic AI voices"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(ae=s.apiKeys)!=null&&ae.elevenlabs?e.jsx("span",{className:"text-xs text-green-400",children:"âœ“ Set"}):e.jsx("span",{className:"text-xs text-white/30",children:"Not set"}),e.jsx("svg",{className:"w-4 h-4 text-white/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})]})]})]},"voice"),S==="shortcuts"&&e.jsxs(m.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Character Interaction"}),e.jsx("div",{className:"space-y-2",children:[{keys:"Alt + Space",action:"Toggle interaction mode"},{keys:"Ctrl + Alt + I",action:"Toggle interaction mode (alt)"},{keys:"Drag (when active)",action:"Move character"},{keys:"Right Click",action:"Open context menu"},{keys:"Click Head",action:"Pat (shows happy reaction)"},{keys:"Click Body",action:"Poke (shows surprised reaction)"},{keys:"Click Hands",action:"Wave (shows friendly reaction)"}].map((n,d)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl",children:[e.jsx("span",{className:"text-sm text-white/80",children:n.action}),e.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-xs text-indigo-300 font-mono",children:n.keys})]},d))})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Window Controls"}),e.jsx("div",{className:"space-y-2",children:[{keys:"Ctrl + Shift + N",action:"Toggle Nizhal visibility"},{keys:"Ctrl + Shift + C",action:"Open chat window"},{keys:"Escape",action:"Close menus/panels",note:"When focused"}].map((n,d)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm text-white/80",children:n.action}),n.note&&e.jsxs("span",{className:"text-xs text-white/40 ml-2",children:["(",n.note,")"]})]}),e.jsx("kbd",{className:"px-2 py-1 bg-white/10 rounded text-xs text-indigo-300 font-mono",children:n.keys})]},d))})]}),e.jsxs("div",{className:"space-y-3 border-t border-white/5 pt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-white/70",children:"Features"}),e.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[e.jsxs("div",{className:"p-3 bg-gradient-to-r from-indigo-500/10 to-purple-500/10 rounded-xl border border-indigo-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’¤"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Sleep Mode"})]}),e.jsx("p",{className:"text-xs text-white/50",children:"Character sleeps when you're idle for 1 minute"})]}),e.jsxs("div",{className:"p-3 bg-gradient-to-r from-pink-500/10 to-rose-500/10 rounded-xl border border-pink-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸ’•"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Compliments"})]}),e.jsx("p",{className:"text-xs text-white/50",children:"Random encouragement every 5 minutes"})]}),e.jsxs("div",{className:"p-3 bg-gradient-to-r from-green-500/10 to-emerald-500/10 rounded-xl border border-green-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:"ðŸª‘"}),e.jsx("span",{className:"text-sm font-medium text-white",children:"Window Sitting"})]}),e.jsx("p",{className:"text-xs text-white/50",children:"Character can sit on windows and taskbar"})]})]})]})]},"shortcuts")]}),e.jsxs("div",{className:"text-center pt-4 pb-2 space-y-2",children:[e.jsx("div",{className:"text-xs text-white/30",children:"Nizhal AI v1.0.0 â€¢ Made with ðŸ’œ in India"}),e.jsxs("div",{className:"flex justify-center gap-4 text-xs text-white/20",children:[e.jsx("button",{onClick:()=>O("https://nizhal.ai/privacy"),className:"hover:text-white/40",children:"Privacy"}),e.jsx("button",{onClick:()=>O("https://nizhal.ai/terms"),className:"hover:text-white/40",children:"Terms"}),e.jsx("button",{onClick:()=>O("https://nizhal.ai/changelog"),className:"hover:text-white/40",children:"Changelog"})]})]})]})}),y&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},className:"absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50",onClick:()=>C(null),children:e.jsxs(m.div,{initial:{scale:.9},animate:{scale:1},onClick:n=>n.stopPropagation(),className:"bg-gray-900 rounded-2xl p-6 max-w-sm w-full border border-white/10",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-2",children:((ie=K.find(n=>n.id===y))==null?void 0:ie.name)||"API Key"}),e.jsx("p",{className:"text-xs text-white/50 mb-4",children:(ne=K.find(n=>n.id===y))==null?void 0:ne.description}),e.jsx("input",{type:"password",value:g,onChange:n=>z(n.target.value),placeholder:"Enter your API key",className:"w-full bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm text-white placeholder-white/30 focus:outline-none focus:border-indigo-500/50 mb-3"}),e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>{var n;return O(((n=K.find(d=>d.id===y))==null?void 0:n.url)||"#")},className:"w-full text-xs text-indigo-400 hover:text-indigo-300 mb-4 text-left",children:"Get API key â†’"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m.button,{whileTap:{scale:.95},onClick:()=>C(null),className:"flex-1 py-2 bg-white/10 text-white rounded-xl",children:"Cancel"}),e.jsx(m.button,{whileTap:{scale:.95},onClick:D,disabled:j,className:"flex-1 py-2 bg-indigo-600 text-white rounded-xl disabled:opacity-50",children:j?"Saving...":"Save"})]})]})})]})},kt=({onBack:r})=>{const[t,i]=o.useState(""),[a,s]=o.useState("neutral"),l=()=>{console.log("Saving journal:",{entry:t,mood:a}),r()};return e.jsxs("div",{className:"flex flex-col h-full p-6 text-white overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsx("button",{onClick:r,className:"mr-4 text-white/60 hover:text-white",children:"â† Back"}),e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-purple-400 to-pink-500 bg-clip-text text-transparent",children:"Daily Journal"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-2",children:"How are you feeling?"}),e.jsx("div",{className:"flex gap-4",children:["ðŸ˜Š","ðŸ˜","ðŸ˜”","ðŸ˜¤","ðŸ¤”"].map(h=>e.jsx("button",{onClick:()=>s(h),className:`text-2xl p-2 rounded-full transition-all ${a===h?"bg-white/20 scale-110":"hover:bg-white/10"}`,children:h},h))})]}),e.jsx("textarea",{value:t,onChange:h=>i(h.target.value),placeholder:"Write your thoughts... or use voice input to narrate your day.",className:"flex-1 bg-black/20 rounded-xl p-4 resize-none focus:outline-none focus:ring-1 focus:ring-purple-500 mb-6"}),e.jsx("button",{onClick:l,className:"w-full py-3 rounded-lg bg-gradient-to-r from-purple-500 to-pink-500 font-semibold hover:opacity-90 transition-opacity",children:"Save Entry"})]})};be(ye);const le=({radius:r,thickness:t,color:i,rotationSpeed:a,segments:s=64,dashArray:l=null})=>{const h=o.useRef();X((f,N)=>{h.current&&(h.current.rotation.z+=a*N)});const c=o.useMemo(()=>new Se(r-t,r,s),[r,t,s]);return e.jsx("mesh",{ref:h,geometry:c,children:e.jsx("meshBasicMaterial",{color:i,transparent:!0,opacity:.6,side:Ie})})},ge=({radius:r,startAngle:t,endAngle:i,color:a,pulse:s})=>{const l=o.useRef();X(c=>{l.current&&s&&(l.current.material.opacity=.3+Math.sin(c.clock.elapsedTime*2)*.3)});const h=o.useMemo(()=>{const c=new Ae,f=r-.05,N=r;c.moveTo(Math.cos(t)*f,Math.sin(t)*f);const j=20;for(let u=0;u<=j;u++){const y=t+(i-t)*(u/j);c.lineTo(Math.cos(y)*N,Math.sin(y)*N)}for(let u=j;u>=0;u--){const y=t+(i-t)*(u/j);c.lineTo(Math.cos(y)*f,Math.sin(y)*f)}return new Te(c)},[r,t,i]);return e.jsx("mesh",{ref:l,geometry:h,children:e.jsx("meshBasicMaterial",{color:a,transparent:!0,opacity:.7})})},Ct=({affection:r=50,mood:t})=>{const i=o.useRef(),a=o.useRef(),s={happy:"#10b981",neutral:"#00d4ff",concerned:"#f59e0b",protective:"#ef4444",playful:"#ec4899",thoughtful:"#8b5cf6"},l=s[t]||s.neutral;return X(h=>{if(i.current){const c=1+Math.sin(h.clock.elapsedTime*2)*.1;i.current.scale.set(c,c,1)}a.current&&(a.current.material.opacity=.2+Math.sin(h.clock.elapsedTime*3)*.1)}),e.jsxs("group",{children:[e.jsxs("mesh",{ref:a,children:[e.jsx("circleGeometry",{args:[.4,32]}),e.jsx("meshBasicMaterial",{color:l,transparent:!0,opacity:.3})]}),e.jsxs("mesh",{ref:i,children:[e.jsx("circleGeometry",{args:[.2,32]}),e.jsx("meshBasicMaterial",{color:l})]})]})},Mt=({mood:r,affection:t,isActive:i})=>{const{size:a}=J();return e.jsxs("group",{children:[e.jsx(le,{radius:1.5,thickness:.02,color:"#00d4ff",rotationSpeed:.3}),e.jsx(le,{radius:1.3,thickness:.03,color:"#00d4ff",rotationSpeed:-.2}),e.jsx(le,{radius:1.1,thickness:.02,color:"#ff6b35",rotationSpeed:.4}),e.jsx(ge,{radius:1.4,startAngle:0,endAngle:Math.PI*(t/100)*2,color:"#00d4ff",pulse:!0}),e.jsx(ge,{radius:1.2,startAngle:Math.PI,endAngle:Math.PI*1.5,color:"#ff6b35",pulse:!0}),e.jsx(Ct,{affection:t,mood:r}),[0,1,2,3].map(s=>e.jsxs("mesh",{position:[Math.cos(s*Math.PI/2)*.9,Math.sin(s*Math.PI/2)*.9,0],children:[e.jsx("circleGeometry",{args:[.03,8]}),e.jsx("meshBasicMaterial",{color:"#00d4ff"})]},s))]})},zt=({mood:r,affection:t=50,isActive:i})=>e.jsxs(m.div,{initial:{opacity:0},animate:{opacity:i?.8:.4},className:"absolute inset-0 pointer-events-none",children:[e.jsxs(ve,{camera:{position:[0,0,3],fov:50},style:{background:"transparent"},gl:{alpha:!0,antialias:!0},children:[e.jsx("ambientLight",{intensity:.5}),e.jsx(Mt,{mood:r,affection:t,isActive:i})]}),e.jsx("div",{className:"absolute bottom-20 left-4 right-4 pointer-events-none",children:e.jsxs("div",{className:"flex justify-between text-xs font-mono text-cyan-400/60",children:[e.jsx("span",{children:"SYS: ONLINE"}),e.jsxs("span",{children:["AFFECTION: ",t,"%"]})]})})]}),St=({mood:r,moodColor:t="#6366f1",isActive:i})=>{const a=o.useMemo(()=>{const s={happy:{color1:"#10b981",color2:"#34d399",color3:"#6ee7b7",animationSpeed:1.2},neutral:{color1:"#6366f1",color2:"#818cf8",color3:"#a5b4fc",animationSpeed:1},concerned:{color1:"#f59e0b",color2:"#fbbf24",color3:"#fcd34d",animationSpeed:.8},protective:{color1:"#ef4444",color2:"#f87171",color3:"#fca5a5",animationSpeed:1.5},playful:{color1:"#ec4899",color2:"#f472b6",color3:"#f9a8d4",animationSpeed:1.8},thoughtful:{color1:"#8b5cf6",color2:"#a78bfa",color3:"#c4b5fd",animationSpeed:.6}};return s[r]||s.neutral},[r]);return e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none overflow-hidden",children:[e.jsxs("div",{className:"relative w-48 h-48",children:[e.jsx(m.div,{className:"absolute inset-0 rounded-full blur-3xl",style:{backgroundColor:a.color1},animate:{scale:[1,1.2,1],opacity:[.3,.5,.3]},transition:{duration:4/a.animationSpeed,repeat:1/0,ease:"easeInOut"}}),e.jsx(m.div,{className:"absolute inset-4 animate-morph",style:{background:`linear-gradient(135deg, ${a.color1}, ${a.color2}, ${a.color3})`,filter:"blur(1px)"},animate:{borderRadius:["60% 40% 30% 70% / 60% 30% 70% 40%","30% 60% 70% 40% / 50% 60% 30% 60%","60% 40% 30% 70% / 60% 30% 70% 40%"],rotate:[0,180,360]},transition:{duration:8/a.animationSpeed,repeat:1/0,ease:"easeInOut"}}),e.jsx(m.div,{className:"absolute inset-8",style:{background:`linear-gradient(225deg, ${a.color2}, ${a.color3})`,filter:"blur(2px)"},animate:{borderRadius:["30% 60% 70% 40% / 50% 60% 30% 60%","60% 40% 30% 70% / 60% 30% 70% 40%","30% 60% 70% 40% / 50% 60% 30% 60%"],rotate:[360,180,0]},transition:{duration:6/a.animationSpeed,repeat:1/0,ease:"easeInOut"}}),e.jsx(m.div,{className:"absolute inset-12 rounded-full",style:{background:`radial-gradient(circle at 30% 30%, ${a.color3}, ${a.color1})`,boxShadow:`0 0 60px ${a.color1}, inset 0 0 30px rgba(255,255,255,0.2)`},animate:{scale:[1,1.1,1]},transition:{duration:2/a.animationSpeed,repeat:1/0,ease:"easeInOut"}}),e.jsx(m.div,{className:"absolute inset-16 rounded-full bg-white/20",style:{boxShadow:"inset 0 0 20px rgba(255,255,255,0.3)"},animate:{opacity:[.3,.6,.3]},transition:{duration:1.5/a.animationSpeed,repeat:1/0,ease:"easeInOut"}}),i&&e.jsx(e.Fragment,{children:[...Array(6)].map((s,l)=>e.jsx(m.div,{className:"absolute w-1 h-1 rounded-full",style:{backgroundColor:a.color3,left:"50%",top:"50%"},animate:{x:[0,Math.cos(l*60*Math.PI/180)*100],y:[0,Math.sin(l*60*Math.PI/180)*100],opacity:[1,0],scale:[1,0]},transition:{duration:2,repeat:1/0,delay:l*.3,ease:"easeOut"}},l))})]}),e.jsx(m.div,{className:"absolute bottom-24 left-0 right-0 text-center",initial:{opacity:0},animate:{opacity:.6},children:e.jsx("span",{className:"text-xs font-medium tracking-wider uppercase",style:{color:a.color2},children:r||"neutral"})})]})},It=({personaId:r="default",currentState:t="idle",mood:i="neutral",size:a="medium",className:s=""})=>{const[l,h]=o.useState(!1),[c,f]=o.useState(0),N=o.useRef(null),j=o.useRef(null),u={default:{idle:"/videos/avatar/idle_loop.webm",listening:"/videos/avatar/listening.webm",thinking:"/videos/avatar/thinking.webm",speaking:"/videos/avatar/speaking.webm",happy:"/videos/avatar/happy.webm",wave:"/videos/avatar/wave.webm"},jarvis:{idle:"/videos/jarvis/idle_loop.webm",listening:"/videos/jarvis/listening.webm",thinking:"/videos/jarvis/thinking.webm",speaking:"/videos/jarvis/speaking.webm"},kavya:{idle:"/videos/thozhi/idle_loop.webm",speaking:"/videos/thozhi/speaking.webm",listening:"/videos/thozhi/listening_nod.webm",happy:"/videos/thozhi/happy_laugh.webm",greeting:"/videos/thozhi/greeting_wave.webm",sad:"/videos/thozhi/sad_concern.webm"},arjun:{idle:"/videos/thozhan/idle.webm",speaking:"/videos/thozhan/speaking.webm"},naruto:{idle:"/videos/anime/naruto_idle.webm"},goku:{idle:"/videos/anime/goku_idle.webm"},elsa:{idle:"/videos/cartoon/elsa_idle.webm"}},y={small:"w-32 h-32",medium:"w-48 h-48",large:"w-64 h-64",fullscreen:"w-full h-full"},C=()=>{const g=u[r]||u.default;return g[t]||g.idle};return o.useEffect(()=>{c===0?N.current:j.current;const g=c===0?j.current:N.current;g&&(g.src=C(),g.load(),g.oncanplaythrough=()=>{g.play().then(()=>{f(z=>z===0?1:0)}).catch(console.error)})},[t,r]),o.useEffect(()=>{const g=N.current;g&&(g.src=C(),g.load(),g.oncanplaythrough=()=>{g.play().then(()=>h(!0)).catch(console.error)})},[]),e.jsxs("div",{className:`relative overflow-visible ${y[a]} ${s}`,children:[!l&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-900",children:e.jsx(m.div,{className:"w-8 h-8 border-2 border-indigo-500 border-t-transparent rounded-full",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})}),e.jsx("video",{ref:N,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-300 ${c===0?"opacity-100":"opacity-0"}`,loop:!0,muted:!0,playsInline:!0}),e.jsx("video",{ref:j,className:`absolute inset-0 w-full h-full object-cover transition-opacity duration-300 ${c===1?"opacity-100":"opacity-0"}`,loop:!0,muted:!0,playsInline:!0}),e.jsx(Z,{children:t==="listening"&&e.jsx(m.div,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.8},className:"absolute -bottom-2 left-1/2 transform -translate-x-1/2",children:e.jsx("div",{className:"flex gap-1",children:[0,1,2,3,4].map(g=>e.jsx(m.div,{className:"w-1 bg-indigo-500 rounded-full",animate:{height:[8,20,8]},transition:{duration:.5,repeat:1/0,delay:g*.1}},g))})})})]})},At=({personaId:r="jarvis",activeSkin:t="default",personalityState:i,isActive:a=!0,showVideoAvatar:s=!0})=>{const l=c=>{const f={happy:"#10b981",neutral:"#6366f1",concerned:"#f59e0b",protective:"#ef4444",playful:"#ec4899",thoughtful:"#8b5cf6"};return f[c]||f.neutral},h=()=>t==="jarvis_hud"||r==="jarvis"?e.jsx(zt,{mood:i==null?void 0:i.mood,affection:i==null?void 0:i.affection,isActive:a}):s&&["kavya","arjun","tamil_nanban","naruto","goku","elsa"].includes(r)?e.jsx("div",{className:"relative w-full h-full flex items-center justify-center",children:e.jsx(It,{personaId:r,currentState:a?"listening":"idle",mood:i==null?void 0:i.mood,size:"fullscreen"})}):e.jsx(St,{mood:i==null?void 0:i.mood,moodColor:l(i==null?void 0:i.mood),isActive:a});return e.jsx("div",{className:"absolute inset-0 pointer-events-none z-0",children:h()})},Tt=({currentView:r,onViewChange:t})=>{const i=[{id:"chat",icon:"chat",label:"Chat"},{id:"journal",icon:"journal",label:"Journal"},{id:"marketplace",icon:"shop",label:"Store"},{id:"settings",icon:"settings",label:"Settings"}],a={chat:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"}),journal:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"}),shop:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"}),settings:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"})};return e.jsx("div",{className:"h-14 flex items-center justify-around px-4 bg-black/20 border-t border-white/5",children:i.map(s=>e.jsxs(m.button,{onClick:()=>t(s.id),whileHover:{scale:1.1},whileTap:{scale:.9},className:`flex flex-col items-center gap-1 p-2 rounded-xl transition-all ${r===s.id?"text-indigo-400":"text-white/50 hover:text-white/80"}`,children:[e.jsxs("div",{className:"relative",children:[r===s.id&&e.jsx(m.div,{layoutId:"nav-indicator",className:"absolute inset-0 bg-indigo-500/20 rounded-lg",initial:!1,transition:{type:"spring",stiffness:500,damping:30}}),e.jsxs("svg",{className:"w-6 h-6 relative z-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[a[s.icon],s.icon==="settings"&&e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})]}),e.jsx("span",{className:"text-xs font-medium",children:s.label})]},s.id))})};function Pt(r,t,i){const a=J(C=>C.size),s=J(C=>C.viewport),l=typeof r=="number"?r:a.width*s.dpr,h=a.height*s.dpr,c=(typeof r=="number"?i:r)||{},{samples:f=0,depth:N,...j}=c,u=N??c.depthBuffer,y=o.useMemo(()=>{const C=new Pe(l,h,{minFilter:ue,magFilter:ue,type:Ee,...j});return u&&(C.depthTexture=new Le(l,h,Re)),C.samples=f,C},[]);return o.useLayoutEffect(()=>{y.setSize(l,h),f&&(y.samples=f)},[f,y,l,h]),o.useEffect(()=>()=>y.dispose(),[]),y}const Et=r=>typeof r=="function",Lt=o.forwardRef(({envMap:r,resolution:t=256,frames:i=1/0,makeDefault:a,children:s,...l},h)=>{const c=J(({set:x})=>x),f=J(({camera:x})=>x),N=J(({size:x})=>x),j=o.useRef(null);o.useImperativeHandle(h,()=>j.current,[]);const u=o.useRef(null),y=Pt(t);o.useLayoutEffect(()=>{l.manual||(j.current.aspect=N.width/N.height)},[N,l]),o.useLayoutEffect(()=>{j.current.updateProjectionMatrix()});let C=0,g=null;const z=Et(s);return X(x=>{z&&(i===1/0||C<i)&&(u.current.visible=!1,x.gl.setRenderTarget(y),g=x.scene.background,r&&(x.scene.background=r),x.gl.render(x.scene,j.current),x.scene.background=g,x.gl.setRenderTarget(null),u.current.visible=!0,C++)}),o.useLayoutEffect(()=>{if(a){const x=f;return c(()=>({camera:j.current})),()=>c(()=>({camera:x}))}},[j,a,c]),o.createElement(o.Fragment,null,o.createElement("perspectiveCamera",Fe({ref:j},l),!z&&s),o.createElement("group",{ref:u},z&&s(y.texture)))});be(ye);const Rt=({isActive:r,analyserOut:t,analyserIn:i,isUserSpeaking:a})=>{const s=o.useRef(null),l=4e3,h=2,c=o.useMemo(()=>{const C=new Float32Array(l*3);for(let g=0;g<l;g++){const z=Math.random(),x=Math.random(),w=2*Math.PI*z,p=Math.acos(2*x-1),k=h*Math.sin(p)*Math.cos(w),S=h*Math.sin(p)*Math.sin(w),T=h*Math.cos(p);C[g*3]=k,C[g*3+1]=S,C[g*3+2]=T}return C},[l,h]),f=o.useMemo(()=>c.slice(),[c]),N=o.useMemo(()=>new Uint8Array((t==null?void 0:t.frequencyBinCount)||128),[t]),j=o.useMemo(()=>new Uint8Array((i==null?void 0:i.frequencyBinCount)||128),[i]),u=o.useRef(.2),y=o.useRef(new me("#555555"));return X(C=>{if(!s.current)return;const g=C.clock.getElapsedTime();s.current.rotation.y=g*.05,s.current.rotation.z=g*.02;let z=a||!1;if(r&&i){i.getByteFrequencyData(j);let k=0;for(let T=0;T<j.length;T++)k+=j[T];k/j.length>5&&(z=!0)}if(r&&t){t.getByteFrequencyData(N);let k=0;for(let S=0;S<N.length;S++)k+=N[S];k/N.length}const x=r?1:.2;u.current=$e.lerp(u.current,x,.05);const w=new me;r?z?w.set("#ffffff"):w.set("#00ffff"):w.set("#555555"),y.current.lerp(w,.1),s.current.material instanceof Oe&&s.current.material.color.copy(y.current);const p=s.current.geometry.attributes.position.array;for(let k=0;k<l;k++){const S=k*3,T=k*3+1,I=k*3+2,M=f[S],B=f[T],D=f[I],G=k%N.length,Q=r?N[G]:0,Y=r?.5:.05,O=Q/255*Y,E=Math.sin(g*2+k*.01)*.05,P=u.current+O+(r?0:E);p[S]=M*P,p[T]=B*P,p[I]=D*P}s.current.geometry.attributes.position.needsUpdate=!0}),e.jsxs("points",{ref:s,children:[e.jsx("bufferGeometry",{children:e.jsx("bufferAttribute",{attach:"attributes-position",count:c.length/3,array:c,itemSize:3})}),e.jsx("pointsMaterial",{size:.03,color:"#555555",transparent:!0,opacity:.8,sizeAttenuation:!0,blending:_e})]})},_t=({isActive:r,analyserOut:t,analyserIn:i,isUserSpeaking:a=!1,compact:s=!1})=>{const l=s?"h-32":"h-full";return e.jsxs("div",{className:`w-full ${l} relative bg-black/50 overflow-hidden rounded-2xl`,children:[e.jsxs(ve,{camera:{position:[0,0,6],fov:45},children:[e.jsx(Lt,{makeDefault:!0,position:[0,0,s?10:8]}),e.jsx("ambientLight",{intensity:.5}),e.jsx(Rt,{isActive:r,analyserOut:t,analyserIn:i,isUserSpeaking:a}),e.jsx(He,{enableZoom:!1,enablePan:!1,autoRotate:!1})]}),e.jsx("div",{className:"absolute bottom-4 left-0 right-0 text-center pointer-events-none",children:e.jsx("div",{className:`inline-block px-4 py-1 rounded-full border ${r?a?"bg-white/10 border-white/30 text-white":"bg-cyan-500/10 border-cyan-500/30 text-cyan-400":"bg-white/5 border-white/10 text-slate-500"} backdrop-blur-md transition-all duration-300`,children:e.jsx("span",{className:"text-[10px] font-mono tracking-[0.2em] font-bold",children:r?a?"LISTENING":"SPEAKING":"IDLE"})})})]})};class $t{constructor(){this.stream=null,this.videoElement=null,this.canvas=null,this.ctx=null,this.isCapturing=!1,this.captureInterval=null,this.frameRate=1e3,this.onFrameCallback=null,this.privacyMode=!1}async initialize(t){return this.videoElement=t,this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),!0}async startCamera(t={}){if(this.privacyMode)return console.warn("[CameraService] Privacy mode enabled, camera blocked"),!1;try{const i={video:{width:{ideal:640},height:{ideal:480},facingMode:"user",...t.video},audio:!1};return this.stream=await navigator.mediaDevices.getUserMedia(i),this.videoElement&&(this.videoElement.srcObject=this.stream,await this.videoElement.play(),this.canvas.width=this.videoElement.videoWidth||640,this.canvas.height=this.videoElement.videoHeight||480),console.log("[CameraService] Camera started"),!0}catch(i){return console.error("[CameraService] Failed to start camera:",i),!1}}stopCamera(){this.stream&&(this.stream.getTracks().forEach(t=>t.stop()),this.stream=null),this.videoElement&&(this.videoElement.srcObject=null),this.stopCapturing(),console.log("[CameraService] Camera stopped")}startCapturing(t,i=1e3){return this.privacyMode?(console.warn("[CameraService] Privacy mode enabled, capture blocked"),!1):(this.onFrameCallback=t,this.frameRate=i,this.isCapturing=!0,this.captureInterval=setInterval(()=>{if(this.isCapturing&&this.stream&&this.onFrameCallback){const a=this.captureFrame();a&&this.onFrameCallback(a)}},this.frameRate),console.log(`[CameraService] Started capturing at ${1e3/i} FPS`),!0)}stopCapturing(){this.isCapturing=!1,this.captureInterval&&(clearInterval(this.captureInterval),this.captureInterval=null),this.onFrameCallback=null}captureFrame(t="jpeg",i=.7){if(!this.videoElement||!this.stream)return null;try{this.ctx.drawImage(this.videoElement,0,0,this.canvas.width,this.canvas.height);const a=t==="png"?"image/png":"image/jpeg";return{data:this.canvas.toDataURL(a,i).split(",")[1],mimeType:a,width:this.canvas.width,height:this.canvas.height,timestamp:Date.now()}}catch(a){return console.error("[CameraService] Frame capture failed:",a),null}}async getAvailableCameras(){try{return(await navigator.mediaDevices.enumerateDevices()).filter(i=>i.kind==="videoinput")}catch(t){return console.error("[CameraService] Failed to enumerate devices:",t),[]}}async switchCamera(t){return this.stopCamera(),this.startCamera({video:{deviceId:{exact:t}}})}setPrivacyMode(t){this.privacyMode=t,t&&this.stream&&(this.stopCamera(),console.log("[CameraService] Privacy mode enabled, camera stopped"))}isActive(){return this.stream!==null&&this.stream.active}dispose(){this.stopCamera(),this.canvas=null,this.ctx=null,this.videoElement=null}}const U=new $t,Ot=({enabled:r=!1,onToggle:t,onFrame:i,privacyMode:a=!1,showControls:s=!0,className:l=""})=>{const h=o.useRef(null),[c,f]=o.useState(!1),[N,j]=o.useState(null),[u,y]=o.useState([]),[C,g]=o.useState(null);o.useEffect(()=>{U.setPrivacyMode(a)},[a]),o.useEffect(()=>(r&&!a?z():x(),()=>{x()}),[r,a]);const z=async()=>{if(j(null),h.current){if(!await U.initialize(h.current)){j("Failed to initialize camera");return}if(await U.startCamera()){f(!0);const T=await U.getAvailableCameras();y(T),T.length>0&&g(T[0].deviceId),i&&U.startCapturing(i,2e3)}else j("Camera access denied or unavailable")}},x=()=>{U.stopCamera(),f(!1)},w=async()=>{if(u.length<=1)return;const S=(u.findIndex(M=>M.deviceId===C)+1)%u.length,T=u[S];await U.switchCamera(T.deviceId)&&g(T.deviceId)},p=()=>{t&&t(!r)};return a?e.jsx("div",{className:`relative rounded-xl overflow-hidden bg-slate-900/50 border border-green-500/30 ${l}`,children:e.jsxs("div",{className:"aspect-video flex flex-col items-center justify-center text-green-400 p-4",children:[e.jsx(pe,{size:32,className:"mb-2"}),e.jsx("p",{className:"text-sm font-mono",children:"Privacy Mode Active"}),e.jsx("p",{className:"text-xs text-green-400/60 mt-1",children:"Camera disabled"})]})}):N?e.jsx("div",{className:`relative rounded-xl overflow-hidden bg-slate-900/50 border border-red-500/30 ${l}`,children:e.jsxs("div",{className:"aspect-video flex flex-col items-center justify-center text-red-400 p-4",children:[e.jsx(Ye,{size:32,className:"mb-2"}),e.jsx("p",{className:"text-sm",children:N}),e.jsxs(m.button,{whileTap:{scale:.95},onClick:z,className:"mt-3 px-4 py-2 text-xs bg-red-500/20 hover:bg-red-500/30 rounded-lg",children:[e.jsx(fe,{size:14,className:"inline mr-1"}),"Retry"]})]})}):e.jsxs("div",{className:`relative rounded-xl overflow-hidden bg-black/50 ${l}`,children:[e.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,muted:!0,className:`w-full h-full object-cover ${r?"block":"hidden"}`}),!r&&e.jsxs("div",{className:"aspect-video flex flex-col items-center justify-center text-slate-500 p-4",children:[e.jsx(Ze,{size:32,className:"mb-2"}),e.jsx("p",{className:"text-sm",children:"Camera Off"}),s&&e.jsx(m.button,{whileTap:{scale:.95},onClick:p,className:"mt-3 px-4 py-2 text-xs bg-cyan-500/20 hover:bg-cyan-500/30 text-cyan-400 rounded-lg",children:"Enable Camera"})]}),r&&c&&e.jsxs("div",{className:"absolute top-2 right-2 flex items-center gap-1 px-2 py-1 bg-red-500/80 rounded-full",children:[e.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full animate-pulse"}),e.jsx("span",{className:"text-[10px] font-mono text-white",children:"LIVE"})]}),r&&c&&u.length>1&&s&&e.jsx(m.button,{whileTap:{scale:.9},onClick:w,className:"absolute bottom-2 right-2 p-2 bg-black/50 hover:bg-black/70 rounded-full",title:"Switch camera",children:e.jsx(fe,{size:14,className:"text-white"})}),r&&s&&e.jsx(m.button,{whileTap:{scale:.9},onClick:p,className:"absolute bottom-2 left-2 p-2 bg-black/50 hover:bg-red-500/50 rounded-full",title:"Disable camera",children:e.jsx(pe,{size:14,className:"text-white"})})]})},Ft=({persona:r,personalityState:t,isConnected:i,isListening:a,isSpeaking:s,isUserSpeaking:l,isCameraEnabled:h,privacyMode:c,analyserIn:f,analyserOut:N,onConnect:j,onDisconnect:u,onMicToggle:y,onCameraToggle:C,onPrivacyToggle:g,onRestore:z,onSettingsOpen:x})=>{const[w,p]=o.useState("chat"),[k,S]=o.useState({cpu:"0%",memory:"0%",connection:"Offline"});o.useEffect(()=>{T();const I=setInterval(T,5e3);return()=>clearInterval(I)},[]);const T=async()=>{var I,M,B;try{const D=await((B=(M=(I=window.nizhal)==null?void 0:I.system)==null?void 0:M.getSystemInfo)==null?void 0:B.call(M));D&&S({cpu:`${D.cpu||0}%`,memory:`${D.memory||0}%`,connection:"Online"})}catch{}};return e.jsxs("div",{className:"h-full w-full flex flex-col bg-slate-950 text-white overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-white/5 bg-slate-900/50",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${i?"bg-cyan-400 animate-pulse":"bg-slate-500"}`}),e.jsx("span",{className:"text-lg font-light tracking-wider",children:(r==null?void 0:r.displayName)||"NIZHAL AI"})]}),c&&e.jsxs("div",{className:"flex items-center gap-1 px-2 py-1 bg-green-500/10 border border-green-500/30 rounded-full",children:[e.jsx(de,{size:12,className:"text-green-400"}),e.jsx("span",{className:"text-[10px] text-green-400 font-mono",children:"LOCAL MODE"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"hidden md:flex items-center gap-4 mr-4 text-xs text-slate-500 font-mono",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(st,{size:12})," ",k.cpu]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(Ke,{size:12})," ",k.memory]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(vt,{size:12,className:i?"text-cyan-400":""})," ",k.connection]})]}),e.jsx("button",{onClick:g,className:`p-2 rounded-lg transition-colors ${c?"bg-green-500/20 text-green-400 border border-green-500/30":"bg-white/5 text-slate-400 hover:bg-white/10"}`,title:c?"Privacy Mode: ON (Local Only)":"Privacy Mode: OFF (Cloud AI)",children:c?e.jsx(de,{size:18}):e.jsx(mt,{size:18})}),e.jsx("button",{onClick:x,className:"p-2 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",title:"Settings",children:e.jsx(ht,{size:18,className:"text-slate-400"})}),e.jsx("button",{onClick:z,className:"p-2 bg-white/5 hover:bg-white/10 rounded-lg transition-colors",title:"Restore to compact mode",children:e.jsx(et,{size:18,className:"text-slate-400"})})]})]}),e.jsxs("div",{className:"flex-1 flex overflow-hidden",children:[e.jsxs("div",{className:"w-1/3 min-w-[300px] flex flex-col border-r border-white/5",children:[e.jsx("div",{className:"flex-1 p-4",children:e.jsx(_t,{isActive:i&&(a||s),analyserOut:N,analyserIn:f,isUserSpeaking:l})}),e.jsx("div",{className:"p-4 pt-0",children:e.jsx(Ot,{enabled:h,onToggle:C,privacyMode:c,showControls:!0,className:"aspect-video"})}),e.jsxs("div",{className:"p-4 border-t border-white/5",children:[e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(m.button,{onClick:y,whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-4 rounded-full transition-all ${a?"bg-cyan-500 text-white shadow-lg shadow-cyan-500/50":"bg-white/10 text-slate-400 hover:bg-white/20"}`,children:a?e.jsx(rt,{size:24}):e.jsx(it,{size:24})}),e.jsx(m.button,{onClick:C,whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-4 rounded-full transition-all ${h?"bg-cyan-500 text-white":"bg-white/10 text-slate-400 hover:bg-white/20"}`,children:h?e.jsx(wt,{size:24}):e.jsx(ft,{size:24})}),e.jsx(m.button,{onClick:i?u:j,whileHover:{scale:1.05},whileTap:{scale:.95},className:`p-4 rounded-full transition-all ${i?"bg-red-500/20 text-red-400 border border-red-500/30":"bg-green-500/20 text-green-400 border border-green-500/30"}`,children:e.jsx(lt,{size:24})})]}),e.jsx("p",{className:"text-center text-xs text-slate-500 mt-3 font-mono",children:i?a?"Listening...":s?"Speaking...":"Connected":"Tap to connect"})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"flex items-center gap-1 px-4 pt-4",children:["chat","notes","tasks"].map(I=>e.jsx("button",{onClick:()=>p(I),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${w===I?"bg-cyan-500/20 text-cyan-400 border border-cyan-500/30":"text-slate-400 hover:bg-white/5"}`,children:I.charAt(0).toUpperCase()+I.slice(1)},I))}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsxs(Z,{mode:"wait",children:[w==="chat"&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full",children:e.jsx(Ne,{persona:r,personalityState:t})},"chat"),w==="notes"&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full p-4",children:e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:e.jsx("p",{children:"Notes feature coming soon..."})})},"notes"),w==="tasks"&&e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-full p-4",children:e.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:e.jsx("p",{children:"Tasks feature coming soon..."})})},"tasks")]})})]})]})]})},Ht="gemini-2.5-flash-preview-native-audio-dialog",ce=16e3,we=24e3;class Bt{constructor(){this.session=null,this.isConnected=!1,this.isPrivacyMode=!1,this.inputContext=null,this.outputContext=null,this.inputProcessor=null,this.inputSource=null,this.outputNode=null,this.analyserIn=null,this.analyserOut=null,this.activeSources=new Set,this.nextStartTime=0,this.stream=null,this.onStateChange=null,this.onTranscription=null,this.onAudioLevel=null,this.onError=null}setPrivacyMode(t){this.isPrivacyMode=t,t&&this.isConnected&&this.disconnect()}ensureAudioContexts(){this.inputContext||(this.inputContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:ce}),this.analyserIn=this.inputContext.createAnalyser(),this.analyserIn.fftSize=256),this.outputContext||(this.outputContext=new(window.AudioContext||window.webkitAudioContext)({sampleRate:we}),this.analyserOut=this.outputContext.createAnalyser(),this.analyserOut.fftSize=256,this.outputNode=this.outputContext.createGain(),this.outputNode.connect(this.analyserOut),this.analyserOut.connect(this.outputContext.destination))}getAnalysers(){return{analyserIn:this.analyserIn,analyserOut:this.analyserOut}}async connect(t,i="",a=[]){var s,l,h;if(this.isPrivacyMode)return console.warn("[GeminiLive] Privacy mode enabled, blocking cloud connection"),(s=this.onError)==null||s.call(this,"Privacy mode is enabled. Disable it to use cloud AI."),!1;if(!t)return(l=this.onError)==null||l.call(this,"Gemini API key is required"),!1;try{this.ensureAudioContexts(),this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:ce,channelCount:1,echoCancellation:!0,noiseSuppression:!0}}),this.inputSource=this.inputContext.createMediaStreamSource(this.stream),this.inputProcessor=this.inputContext.createScriptProcessor(4096,1,1),this.inputSource.connect(this.analyserIn),this.inputSource.connect(this.inputProcessor),this.inputProcessor.connect(this.inputContext.destination);const{GoogleGenAI:c,Modality:f}=await ke(async()=>{const{GoogleGenAI:u,Modality:y}=await import("./index-DAvND36v.js");return{GoogleGenAI:u,Modality:y}},[],import.meta.url),N=new c(t);this.session=await N.live.connect(Ht,{config:{responseModalities:[f.AUDIO,f.TEXT],speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:"Kore"}}},systemInstruction:i||"You are Nizhal AI, a helpful and friendly desktop companion assistant.",tools:a.length>0?a:void 0}});let j=!1;return this.inputProcessor.onaudioprocess=u=>{if(j||!this.session)return;const y=u.inputBuffer.getChannelData(0),C=new Int16Array(y.length);for(let z=0;z<y.length;z++)C[z]=Math.max(-32768,Math.min(32767,y[z]*32768));const g=this.arrayBufferToBase64(C.buffer);this.session.sendRealtimeInput([{media:{mimeType:`audio/pcm;rate=${ce}`,data:g}}])},this.session.on("open",()=>{var u;console.log("[GeminiLive] Connected"),this.isConnected=!0,(u=this.onStateChange)==null||u.call(this,{connected:!0})}),this.session.on("message",u=>{this.handleServerMessage(u)}),this.session.on("close",()=>{var u;console.log("[GeminiLive] Disconnected"),this.isConnected=!1,(u=this.onStateChange)==null||u.call(this,{connected:!1})}),this.session.on("error",u=>{var y;console.error("[GeminiLive] Error:",u),(y=this.onError)==null||y.call(this,u.message||"Connection error")}),this.setMuted=u=>{j=u},!0}catch(c){return console.error("[GeminiLive] Connection failed:",c),(h=this.onError)==null||h.call(this,c.message||"Failed to connect"),!1}}handleServerMessage(t){var i,a,s,l,h;if(t.data){const c=this.base64ToArrayBuffer(t.data);this.playAudio(c)}if((a=(i=t.serverContent)==null?void 0:i.modelTurn)!=null&&a.parts)for(const c of t.serverContent.modelTurn.parts)c.text&&((s=this.onTranscription)==null||s.call(this,{role:"ai",text:c.text}));(l=t.serverContent)!=null&&l.inputTranscript&&((h=this.onTranscription)==null||h.call(this,{role:"user",text:t.serverContent.inputTranscript})),t.toolCall&&this.handleToolCall(t.toolCall)}async handleToolCall(t){var a,s,l,h,c,f,N,j;console.log("[GeminiLive] Tool call:",t);let i={success:!1,message:"Tool not implemented"};try{const u=(s=(a=t.functionCalls)==null?void 0:a[0])==null?void 0:s.name,y=((h=(l=t.functionCalls)==null?void 0:l[0])==null?void 0:h.args)||{};switch(u){case"get_current_time":i={success:!0,time:new Date().toLocaleString()};break;case"open_application":(f=(c=window.nizhal)==null?void 0:c.system)!=null&&f.launchApp&&(await window.nizhal.system.launchApp(y.appName),i={success:!0,message:`Opened ${y.appName}`});break;default:i={success:!1,message:`Unknown tool: ${u}`}}}catch(u){i={success:!1,error:u.message}}this.session&&this.session.sendToolResponse({functionResponses:[{response:i,id:(j=(N=t.functionCalls)==null?void 0:N[0])==null?void 0:j.id}]})}playAudio(t){if(!this.outputContext||!this.outputNode)return;const i=new Float32Array(t.byteLength/2),a=new Int16Array(t);for(let c=0;c<a.length;c++)i[c]=a[c]/32768;const s=this.outputContext.createBuffer(1,i.length,we);s.copyToChannel(i,0);const l=this.outputContext.createBufferSource();l.buffer=s,l.connect(this.outputNode),this.activeSources.add(l),l.onended=()=>{this.activeSources.delete(l)};const h=Math.max(this.outputContext.currentTime,this.nextStartTime);l.start(h),this.nextStartTime=h+s.duration}sendText(t){return!this.session||!this.isConnected?(console.warn("[GeminiLive] Not connected"),!1):(this.session.sendRealtimeInput([{text:t}]),!0)}sendImage(t,i="image/jpeg"){return!this.session||!this.isConnected?(console.warn("[GeminiLive] Not connected"),!1):(this.session.sendRealtimeInput([{media:{mimeType:i,data:t}}]),!0)}disconnect(){var t;if(this.activeSources.forEach(i=>{try{i.stop()}catch{}}),this.activeSources.clear(),this.inputProcessor&&(this.inputProcessor.disconnect(),this.inputProcessor=null),this.inputSource&&(this.inputSource.disconnect(),this.inputSource=null),this.stream&&(this.stream.getTracks().forEach(i=>i.stop()),this.stream=null),this.session){try{this.session.close()}catch{}this.session=null}this.isConnected=!1,this.nextStartTime=0,(t=this.onStateChange)==null||t.call(this,{connected:!1})}setMuted(t){}arrayBufferToBase64(t){let i="";const a=new Uint8Array(t);for(let s=0;s<a.byteLength;s++)i+=String.fromCharCode(a[s]);return btoa(i)}base64ToArrayBuffer(t){const i=atob(t),a=new Uint8Array(i.length);for(let s=0;s<i.length;s++)a[s]=i.charCodeAt(s);return a.buffer}destroy(){this.disconnect(),this.inputContext&&(this.inputContext.close(),this.inputContext=null),this.outputContext&&(this.outputContext.close(),this.outputContext=null)}}const V=new Bt,Dt=()=>{const[r,t]=o.useState(null),[i,a]=o.useState(null),[s,l]=o.useState("chat"),[h,c]=o.useState(!0),[f,N]=o.useState(!1),[j,u]=o.useState("compact"),[y,C]=o.useState(!1),[g,z]=o.useState(!1),[x,w]=o.useState(!1),[p,k]=o.useState(!1),[S,T]=o.useState(!1),[I,M]=o.useState(!1),[B,D]=o.useState(!1),[G,Q]=o.useState(!1),[Y,O]=o.useState(null),[E,P]=o.useState(null);o.useEffect(()=>{var $,R,F,q;ee();const d=async()=>{var re,oe,he;const H=await((he=(oe=(re=window.nizhal)==null?void 0:re.window)==null?void 0:oe.getState)==null?void 0:he.call(oe));H&&(C(H.isMaximized),u(H.isMaximized?"full":"compact"))};d();const b=setInterval(d,1e3),v=($=window.nizhal)==null?void 0:$.onPersonaChange(H=>{t(H)}),A=(R=window.nizhal)==null?void 0:R.onMoodChange(H=>{a(re=>({...re,mood:H}))}),_=(q=(F=window.nizhal)==null?void 0:F.on)==null?void 0:q.call(F,"privacy:changed",H=>{z(H),V.setPrivacyMode(H)});return()=>{clearInterval(b),v==null||v(),A==null||A(),_==null||_(),V.destroy()}},[]);const ee=async()=>{var d,b,v,A,_;try{const $=await((d=window.nizhal)==null?void 0:d.persona.getActive()),R=await((b=window.nizhal)==null?void 0:b.persona.getState()),F=await((_=(A=(v=window.nizhal)==null?void 0:v.privacy)==null?void 0:A.getMode)==null?void 0:_.call(A));t($),a(R),z(F||!1),V.setPrivacyMode(F||!1)}catch($){console.error("Failed to initialize:",$)}finally{c(!1)}},W=o.useCallback(async()=>{var b;const d=!f;await((b=window.nizhal)==null?void 0:b.window.setClickThrough(d)),N(d)},[f]),K=o.useCallback(async()=>{var b,v,A;const d=!g;await((A=(v=(b=window.nizhal)==null?void 0:b.privacy)==null?void 0:v.setMode)==null?void 0:A.call(v,d)),z(d),V.setPrivacyMode(d)},[g]),te=o.useCallback(async()=>{var $,R,F;if(g){console.warn("Privacy mode enabled, cannot connect to cloud");return}const d=await((F=(R=($=window.nizhal)==null?void 0:$.memory)==null?void 0:R.getUserPreferences)==null?void 0:F.call(R)),b=d==null?void 0:d.geminiApiKey;if(!b){console.error("Gemini API key not configured"),l("settings");return}const A=`You are ${(r||{name:"Nizhal AI"}).name}, a helpful and friendly AI desktop companion.`;if(await V.connect(b,A)){w(!0),k(!0);const{analyserIn:q,analyserOut:H}=V.getAnalysers();O(q),P(H)}},[g,r]),se=o.useCallback(()=>{V.disconnect(),w(!1),k(!1),M(!1)},[]),ae=o.useCallback(()=>{x&&(V.setMuted(p),k(!p))},[x,p]),ie=o.useCallback(async()=>{Q(!G)},[G]),ne=o.useCallback(async()=>{var b,v,A;const d=await((A=(v=(b=window.nizhal)==null?void 0:b.window)==null?void 0:v.maximize)==null?void 0:A.call(v));C(d),u(d?"full":"compact")},[]),n=o.useCallback(async()=>{var b,v,A;const d=await((A=(v=(b=window.nizhal)==null?void 0:b.window)==null?void 0:v.maximize)==null?void 0:A.call(v));C(d),u(d?"full":"compact")},[]);return h?e.jsx("div",{className:"h-full w-full flex items-center justify-center glass-panel",children:e.jsx(m.div,{className:"w-16 h-16 rounded-full border-4 border-primary border-t-transparent",animate:{rotate:360},transition:{duration:1,repeat:1/0,ease:"linear"}})}):j==="full"&&y?e.jsx(Ft,{persona:r,personalityState:i,isConnected:x,isListening:p,isSpeaking:I,isUserSpeaking:B,isCameraEnabled:G,privacyMode:g,analyserIn:Y,analyserOut:E,onConnect:te,onDisconnect:se,onMicToggle:ae,onCameraToggle:ie,onPrivacyToggle:K,onRestore:n,onSettingsOpen:()=>l("settings")}):e.jsxs("div",{className:"h-full w-full flex flex-col bg-slate-950 text-white overflow-hidden",children:[e.jsx(yt,{personaName:(r==null?void 0:r.displayName)||"Nizhal AI",clickThrough:f,onClickThroughToggle:W,onMaximize:ne,privacyMode:g}),e.jsxs("div",{className:"flex-1 flex flex-col overflow-hidden relative",children:[e.jsx(At,{personaId:r==null?void 0:r.id,activeSkin:r==null?void 0:r.skin,personalityState:i,isActive:s==="chat"}),e.jsx("div",{className:"relative z-10 flex-1 overflow-hidden",children:e.jsx(Z,{mode:"wait",children:e.jsxs(m.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2},className:"h-full",children:[s==="chat"&&e.jsx(Ne,{persona:r,personalityState:i,onListeningChange:k,onThinkingChange:T,onSpeakingChange:M}),s==="marketplace"&&e.jsx(jt,{onBack:()=>l("chat")}),s==="journal"&&e.jsx(kt,{onBack:()=>l("chat")}),s==="settings"&&e.jsx(Nt,{onBack:()=>l("chat"),onPersonaChange:t,privacyMode:g,onPrivacyToggle:K})]},s)})})]}),e.jsx(Tt,{currentView:s,onViewChange:l})]})};Ce.createRoot(document.getElementById("root")).render(e.jsx(Me.StrictMode,{children:e.jsx(ze,{children:e.jsx(Dt,{})})}));
